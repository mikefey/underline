(function(s,u){'object'==typeof exports&&'object'==typeof module?module.exports=u(require('xmldom'),function(){try{return require('JSZip')}catch(f){}}()):'function'==typeof define&&define.amd?define(['xmldom','JSZip'],u):'object'==typeof exports?exports.ePub=u(require('xmldom'),function(){try{return require('JSZip')}catch(f){}}()):s.ePub=u(s.xmldom,s.JSZip)})(this,function(t,s){return function(u){function p(v){if(f[v])return f[v].exports;var k=f[v]={i:v,l:!1,exports:{}};return u[v].call(k.exports,k,k.exports,p),k.l=!0,k.exports}var f={};return p.m=u,p.c=f,p.i=function(v){return v},p.d=function(v,k,_){p.o(v,k)||Object.defineProperty(v,k,{configurable:!1,enumerable:!0,get:_})},p.n=function(v){var k=v&&v.__esModule?function(){return v['default']}:function(){return v};return p.d(k,'a',k),k},p.o=function(v,k){return Object.prototype.hasOwnProperty.call(v,k)},p.p='/dist/',p(p.s=22)}([function(u,p,f){'use strict';function k(){var le=new Date().getTime(),de='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(ue){var ce=0|(le+16*Math.random())%16;return le=Math.floor(le/16),('x'==ue?ce:8|7&ce).toString(16)});return de}function C(le){return!isNaN(parseFloat(le))&&isFinite(le)}function z(le,de,ue,ce,pe){var me,ge=ce||0,he=pe||de.length,fe=parseInt(ge+(he-ge)/2);return(ue||(ue=function(ve,be){return ve>be?1:ve<be?-1:ve==be?0:void 0}),0>=he-ge)?fe:(me=ue(de[fe],le),1==he-ge?0<me?fe:fe+1:0===me?fe:-1===me?z(le,de,ue,fe,he):z(le,de,ue,ge,fe))}function R(le,de,ue,ce,pe){var me,ge=ce||0,he=pe||de.length,fe=parseInt(ge+(he-ge)/2);return(ue||(ue=function(ve,be){return ve>be?1:ve<be?-1:ve==be?0:void 0}),0>=he-ge)?-1:(me=ue(de[fe],le),1==he-ge?0===me?fe:-1:0===me?fe:-1===me?R(le,de,ue,fe,he):R(le,de,ue,ge,fe))}function M(le,de){for(var pe,ue=le.parentNode,ce=ue.childNodes,ge=-1,he=0;he<ce.length&&(pe=ce[he],pe.nodeType===de&&ge++,pe!=le);he++);return ge}function J(le,de){return'undefined'==typeof le.querySelector?le.getElementsByTagName(de):le.querySelectorAll(de)}function K(le,de,ue){for(var pe,ce=document.createTreeWalker(le,ue,null,!1);pe=ce.nextNode();)de(pe)}function G(le,de){if(de(le))return!0;if(le=le.firstChild,le)do{var ue=G(le,de);if(ue)return!0;le=le.nextSibling}while(le)}Object.defineProperty(p,'__esModule',{value:!0}),p.isElement=function(le){return!!(le&&1==le.nodeType)},p.uuid=k,p.documentHeight=function(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},p.isNumber=C,p.isFloat=function(le){return C(le)&&Math.floor(le)!==le},p.prefixed=function(le){var de=['-Webkit-','-moz-','-o-','-ms-'],ue=le[0].toUpperCase()+le.slice(1),ce=de.length;if('undefined'==typeof document||'undefined'!=typeof document.body.style[le])return le;for(var pe=0;pe<ce;pe++)if('undefined'!=typeof document.body.style[de[pe]+ue])return de[pe]+ue;return le},p.defaults=function(le){for(var ce,de=1,ue=arguments.length;de<ue;de++)for(var pe in ce=arguments[de],ce)void 0===le[pe]&&(le[pe]=ce[pe]);return le},p.extend=function(le){var de=[].slice.call(arguments,1);return de.forEach(function(ue){ue&&Object.getOwnPropertyNames(ue).forEach(function(ce){Object.defineProperty(le,ce,Object.getOwnPropertyDescriptor(ue,ce))})}),le},p.insert=function(le,de,ue){var ce=z(le,de,ue);return de.splice(ce,0,le),ce},p.locationOf=z,p.indexOfSorted=R,p.bounds=function(le){var de=window.getComputedStyle(le),pe=0,ge=0;return['width','paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(he){pe+=parseFloat(de[he])||0}),['height','paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(he){ge+=parseFloat(de[he])||0}),{height:ge,width:pe}},p.borders=function(le){var de=window.getComputedStyle(le),pe=0,ge=0;return['paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(he){pe+=parseFloat(de[he])||0}),['paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(he){ge+=parseFloat(de[he])||0}),{height:ge,width:pe}},p.windowBounds=function(){var le=window.innerWidth,de=window.innerHeight;return{top:0,left:0,right:le,bottom:de,width:le,height:de}},p.cleanStringForXpath=function(le){var de=le.match(/[^'"]+|['"]/g);return de=de.map(function(ue){return'\''===ue?'"\'"':'"'===ue?'\'"\'':'\''+ue+'\''}),'concat(\'\','+de.join(',')+')'},p.indexOfNode=M,p.indexOfTextNode=function(le){return M(le,se)},p.indexOfElementNode=function(le){return M(le,ie)},p.isXml=function(le){return-1<['xml','opf','ncx'].indexOf(le)},p.createBlob=function(le,de){return new Blob([le],{type:de})},p.createBlobUrl=function(le,de){var ce,ue=window.URL||window.webkitURL||window.mozURL,pe=this.createBlob(le,de);return ce=ue.createObjectURL(pe),ce},p.createBase64Url=function(le,de){var ue,ce;if('string'==typeof le)return ue=btoa(le),ce='data:'+de+';base64,'+ue,ce},p.type=function(le){return Object.prototype.toString.call(le).slice(8,-1)},p.parse=function(le,de,ue){var ce,pe;return pe='undefined'==typeof DOMParser||ue?f(15).DOMParser:DOMParser,65279===le.charCodeAt(0)&&(le=le.slice(1)),ce=new pe().parseFromString(le,de),ce},p.qs=function(le,de){var ue;if(!le)throw new Error('No Element Provided');return'undefined'==typeof le.querySelector?(ue=le.getElementsByTagName(de),ue.length)?ue[0]:void 0:le.querySelector(de)},p.qsa=J,p.qsp=function(le,de,ue){var ce,pe;if('undefined'!=typeof le.querySelector){for(var ge in de+='[',ue)de+=ge+'=\''+ue[ge]+'\'';return de+=']',le.querySelector(de)}return(ce=le.getElementsByTagName(de),pe=Array.prototype.slice.call(ce,0).filter(function(he){for(var fe in ue)if(he.getAttribute(fe)===ue[fe])return!0;return!1}),pe)?pe[0]:void 0},p.sprint=function(le,de){var ue=le.ownerDocument||le;'undefined'==typeof ue.createTreeWalker?G(le,function(ce){ce&&3===ce.nodeType&&de(ce)},!0):K(le,de,NodeFilter.SHOW_TEXT)},p.treeWalker=K,p.walk=G,p.blob2base64=function(le){return new Promise(function(de){var ce=new FileReader;ce.readAsDataURL(le),ce.onloadend=function(){de(ce.result)}})},p.defer=function(){var le=this;this.resolve=null,this.reject=null,this.id=k(),this.promise=new Promise(function(de,ue){le.resolve=de,le.reject=ue}),Object.freeze(this)},p.querySelectorByType=function(le,de,ue){var ce;if('undefined'!=typeof le.querySelector&&(ce=le.querySelector(de+'[*|type="'+ue+'"]')),!ce||0===ce.length){ce=J(le,de);for(var pe=0;pe<ce.length;pe++)if(ce[pe].getAttributeNS('http://www.idpf.org/2007/ops','type')===ue)return ce[pe]}else return ce},p.findChildren=function(le){for(var pe,de=[],ue=le.childNodes,ce=0;ce<ue.length;ce++)pe=ue[ce],1===pe.nodeType&&de.push(pe);return de};var ae=p.requestAnimationFrame='undefined'!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),ie=1,se=3},function(u,p,f){'use strict';function v(E,z){if(!(E instanceof z))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var k='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(E){return typeof E}:function(E){return E&&'function'==typeof Symbol&&E.constructor===Symbol&&E!==Symbol.prototype?'symbol':typeof E},_=function(){function E(z,R){for(var B,N=0;N<R.length;N++)B=R[N],B.enumerable=B.enumerable||!1,B.configurable=!0,'value'in B&&(B.writable=!0),Object.defineProperty(z,B.key,B)}return function(z,R,N){return R&&E(z.prototype,R),N&&E(z,N),z}}(),C=f(0),S=1,P=3,T=function(){function E(z,R,N){v(this,E);var B;if(this.str='',this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof E))return new E(z,R,N);if('string'==typeof R?this.base=this.parseComponent(R):'object'===('undefined'==typeof R?'undefined':k(R))&&R.steps&&(this.base=R),B=this.checkType(z),'string'===B)return this.str=z,(0,C.extend)(this,this.parse(z));if('range'===B)return(0,C.extend)(this,this.fromRange(z,this.base,N));if('node'===B)return(0,C.extend)(this,this.fromNode(z,this.base,N));if('EpubCFI'===B&&z.path)return z;if(!z)return this;throw new TypeError('not a valid argument for EpubCFI')}return _(E,[{key:'checkType',value:function(R){return this.isCfiString(R)?'string':'object'===('undefined'==typeof R?'undefined':k(R))&&('Range'===(0,C.type)(R)||'undefined'!=typeof R.startContainer)?'range':'object'===('undefined'==typeof R?'undefined':k(R))&&'undefined'!=typeof R.nodeType?'node':'object'===('undefined'==typeof R?'undefined':k(R))&&R instanceof E&&'EpubCFI'}},{key:'parse',value:function(R){var B,O,A,N={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return'string'==typeof R?(0===R.indexOf('epubcfi(')&&')'===R[R.length-1]&&(R=R.slice(8,R.length-1)),B=this.getChapterComponent(R),!B)?{spinePos:-1}:(N.base=this.parseComponent(B),O=this.getPathComponent(R),N.path=this.parseComponent(O),A=this.getRange(R),A&&(N.range=!0,N.start=this.parseComponent(A[0]),N.end=this.parseComponent(A[1])),N.spinePos=N.base.steps[1].index,N):{spinePos:-1}}},{key:'parseComponent',value:function(R){var A,N={steps:[],terminal:{offset:null,assertion:null}},B=R.split(':'),O=B[0].split('/');return 1<B.length&&(A=B[1],N.terminal=this.parseTerminal(A)),''===O[0]&&O.shift(),N.steps=O.map(function(M){return this.parseStep(M)}.bind(this)),N}},{key:'parseStep',value:function(R){var N,B,O,A,M;if(A=R.match(/\[(.*)\]/),A&&A[1]&&(M=A[1]),B=parseInt(R),!isNaN(B))return 0==B%2?(N='element',O=B/2-1):(N='text',O=(B-1)/2),{type:N,index:O,id:M||null}}},{key:'parseTerminal',value:function(R){var N,B,O=R.match(/\[(.*)\]/);return O&&O[1]?(N=parseInt(R.split('[')[0])||null,B=O[1]):N=parseInt(R)||null,{offset:N,assertion:B}}},{key:'getChapterComponent',value:function(R){var N=R.split('!');return N[0]}},{key:'getPathComponent',value:function(R){var N=R.split('!');if(N[1]){var B=N[1].split(',');return B[0]}}},{key:'getRange',value:function(R){var N=R.split(',');return 3===N.length&&[N[1],N[2]]}},{key:'getCharecterOffsetComponent',value:function(R){var N=R.split(':');return N[1]||''}},{key:'joinSteps',value:function(R){return R?R.map(function(N){var B='';return'element'===N.type&&(B+=2*(N.index+1)),'text'===N.type&&(B+=1+2*N.index),N.id&&(B+='['+N.id+']'),B}).join('/'):''}},{key:'segmentString',value:function(R){var z='/';return z+=this.joinSteps(R.steps),R.terminal&&null!=R.terminal.offset&&(z+=':'+R.terminal.offset),R.terminal&&null!=R.terminal.assertion&&(z+='['+R.terminal.assertion+']'),z}},{key:'toString',value:function(){var R='epubcfi(';return R+=this.segmentString(this.base),R+='!',R+=this.segmentString(this.path),this.start&&(R+=',',R+=this.segmentString(this.start)),this.end&&(R+=',',R+=this.segmentString(this.end)),R+=')',R}},{key:'compare',value:function(R,N){var B,O,A,M;if('string'==typeof R&&(R=new E(R)),'string'==typeof N&&(N=new E(N)),R.spinePos>N.spinePos)return 1;if(R.spinePos<N.spinePos)return-1;R.range?(B=R.path.steps.concat(R.start.steps),A=R.start.terminal):(B=R.path.steps,A=R.path.terminal),N.range?(O=N.path.steps.concat(N.start.steps),M=N.start.terminal):(O=N.path.steps,M=N.path.terminal);for(var W=0;W<B.length;W++){if(!B[W])return-1;if(!O[W])return 1;if(B[W].index>O[W].index)return 1;if(B[W].index<O[W].index)return-1}return B.length<O.length?1:A.offset>M.offset?1:A.offset<M.offset?-1:0}},{key:'step',value:function(R){var N=R.nodeType===P?'text':'element';return{id:R.id,tagName:R.tagName,type:N,index:this.position(R)}}},{key:'filteredStep',value:function(R,N){var O,B=this.filter(R,N);if(B)return O=B.nodeType===P?'text':'element',{id:B.id,tagName:B.tagName,type:O,index:this.filteredPosition(B,N)}}},{key:'pathTo',value:function(R,N,B){for(var M,O={steps:[],terminal:{offset:null,assertion:null}},A=R;A&&A.parentNode&&A.parentNode.nodeType!=9;)M=B?this.filteredStep(A,B):this.step(A),M&&O.steps.unshift(M),A=A.parentNode;return null!=N&&0<=N&&(O.terminal.offset=N,'text'!=O.steps[O.steps.length-1].type&&O.steps.push({type:'text',index:0})),O}},{key:'equalStep',value:function(R,N){return R&&N&&R.index===N.index&&R.id===N.id&&R.type===N.type}},{key:'fromRange',value:function(R,N,B){var O={range:!1,base:{},path:{},start:null,end:null},A=R.startContainer,M=R.endContainer,W=R.startOffset,I=R.endOffset,U=!1;if(B&&(U=null!=A.ownerDocument.querySelector('.'+B)),'string'==typeof N?(O.base=this.parseComponent(N),O.spinePos=O.base.steps[1].index):'object'===('undefined'==typeof N?'undefined':k(N))&&(O.base=N),R.collapsed)U&&(W=this.patchOffset(A,W,B)),O.path=this.pathTo(A,W,B);else{O.range=!0,U&&(W=this.patchOffset(A,W,B)),O.start=this.pathTo(A,W,B),U&&(I=this.patchOffset(M,I,B)),O.end=this.pathTo(M,I,B),O.path={steps:[],terminal:null};var D,F=O.start.steps.length;for(D=0;D<F&&this.equalStep(O.start.steps[D],O.end.steps[D]);D++)D===F-1?O.start.terminal===O.end.terminal&&(O.path.steps.push(O.start.steps[D]),O.range=!1):O.path.steps.push(O.start.steps[D]);O.start.steps=O.start.steps.slice(O.path.steps.length),O.end.steps=O.end.steps.slice(O.path.steps.length)}return O}},{key:'fromNode',value:function(R,N,B){var O={range:!1,base:{},path:{},start:null,end:null};return'string'==typeof N?(O.base=this.parseComponent(N),O.spinePos=O.base.steps[1].index):'object'===('undefined'==typeof N?'undefined':k(N))&&(O.base=N),O.path=this.pathTo(R,null,B),O}},{key:'filter',value:function(R,N){var B,O,A,M,W,I=!1;return R.nodeType===P?(I=!0,A=R.parentNode,B=R.parentNode.classList.contains(N)):(I=!1,B=R.classList.contains(N)),B&&I?(M=A.previousSibling,W=A.nextSibling,M&&M.nodeType===P?O=M:W&&W.nodeType===P&&(O=W),O?O:R):B&&!I?!1:R}},{key:'patchOffset',value:function(R,N,B){if(R.nodeType!=P)throw new Error('Anchor must be a text node');var O=R,A=N;for(R.parentNode.classList.contains(B)&&(O=R.parentNode);O.previousSibling;){if(O.previousSibling.nodeType!==S)A+=O.previousSibling.textContent.length;else if(O.previousSibling.classList.contains(B))A+=O.previousSibling.textContent.length;else break;O=O.previousSibling}return A}},{key:'normalizedMap',value:function(R,N,B){var M,I,U,O={},A=-1,W=R.length;for(M=0;M<W;M++)I=R[M].nodeType,I===S&&R[M].classList.contains(B)&&(I=P),0<M&&I===P&&U===P?O[M]=A:N===I&&(++A,O[M]=A),U=I;return O}},{key:'position',value:function(R){var N,B;return R.nodeType===S?(N=R.parentNode.children,!N&&(N=(0,C.findChildren)(R.parentNode)),B=Array.prototype.indexOf.call(N,R)):(N=this.textNodes(R.parentNode),B=N.indexOf(R)),B}},{key:'filteredPosition',value:function(R,N){var B,O,A;return R.nodeType===S?(B=R.parentNode.children,A=this.normalizedMap(B,S,N)):(B=R.parentNode.childNodes,R.parentNode.classList.contains(N)&&(R=R.parentNode,B=R.parentNode.childNodes),A=this.normalizedMap(B,P,N)),O=Array.prototype.indexOf.call(B,R),A[O]}},{key:'stepsToXpath',value:function(R){var N=['.','*'];return R.forEach(function(B){var O=B.index+1;B.id?N.push('*[position()='+O+' and @id=\''+B.id+'\']'):'text'===B.type?N.push('text()['+O+']'):N.push('*['+O+']')}),N.join('/')}},{key:'stepsToQuerySelector',value:function(R){var N=['html'];return R.forEach(function(B){var O=B.index+1;B.id?N.push('#'+B.id):'text'===B.type||N.push('*:nth-child('+O+')')}),N.join('>')}},{key:'textNodes',value:function(R,N){return Array.prototype.slice.call(R.childNodes).filter(function(B){return B.nodeType===P||N&&B.classList.contains(N)})}},{key:'walkToNode',value:function(R,N,B){var M,I,O=N||document,A=O.documentElement,W=R.length;for(I=0;I<W&&(M=R[I],'element'===M.type?M.id?A=O.getElementById(M.id):A=A.children[M.index]:'text'===M.type&&(A=this.textNodes(A,B)[M.index]),!!A);I++);return A}},{key:'findNode',value:function(R,N,B){var A,M,O=N||document;return B||'undefined'==typeof O.evaluate?B?A=this.walkToNode(R,O,B):A=this.walkToNode(R,O):(M=this.stepsToXpath(R),A=O.evaluate(M,O,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),A}},{key:'fixMiss',value:function(R,N,B,O){var I,U,A=this.findNode(R.slice(0,-1),B,O),M=A.childNodes,W=this.normalizedMap(M,P,O),F=R[R.length-1].index;for(var D in W){if(!W.hasOwnProperty(D))return;if(W[D]===F)if(I=M[D],U=I.textContent.length,N>U)N-=U;else{A=I.nodeType===S?I.childNodes[0]:I;break}}return{container:A,offset:N}}},{key:'toRange',value:function(R,N){var A,M,W,I,F,D,V,B=R||document,O=B.createRange(),U=this,H=!!N&&null!=B.querySelector('.'+N);if(U.range?(A=U.start,F=U.path.steps.concat(A.steps),W=this.findNode(F,B,H?N:null),M=U.end,D=U.path.steps.concat(M.steps),I=this.findNode(D,B,H?N:null)):(A=U.path,F=U.path.steps,W=this.findNode(U.path.steps,B,H?N:null)),W)try{null==A.terminal.offset?O.setStart(W,0):O.setStart(W,A.terminal.offset)}catch(X){V=this.fixMiss(F,A.terminal.offset,B,H?N:null),O.setStart(V.container,V.offset)}else return null;if(I)try{null==M.terminal.offset?O.setEnd(I,0):O.setEnd(I,M.terminal.offset)}catch(X){V=this.fixMiss(D,U.end.terminal.offset,B,H?N:null),O.setEnd(V.container,V.offset)}return O}},{key:'isCfiString',value:function(R){return'string'==typeof R&&0===R.indexOf('epubcfi(')&&')'===R[R.length-1]}},{key:'generateChapterComponent',value:function(R,N,B){var O=parseInt(N),M='/'+2*(R+1)+'/';return M+=2*(O+1),B&&(M+='['+B+']'),M}}]),E}();p.default=T,u.exports=p['default']},function(u,p,f){'use strict';var z,R,N,B,O,A,M,v=f(34),k=f(43),_=Function.prototype.apply,C=Function.prototype.call,S=Object.create,P=Object.defineProperty,L=Object.defineProperties,T=Object.prototype.hasOwnProperty,E={configurable:!0,enumerable:!1,writable:!0};z=function(W,I){var U;return k(I),T.call(this,'__ee__')?U=this.__ee__:(U=E.value=S(null),P(this,'__ee__',E),E.value=null),U[W]?'object'==typeof U[W]?U[W].push(I):U[W]=[U[W],I]:U[W]=I,this},R=function(W,I){var U,F;return k(I),F=this,z.call(this,W,U=function(){N.call(F,W,U),_.call(I,this,arguments)}),U.__eeOnceListener__=I,this},N=function(W,I){var U,F,D,H;if(k(I),!T.call(this,'__ee__'))return this;if(U=this.__ee__,!U[W])return this;if(F=U[W],'object'==typeof F)for(H=0;D=F[H];++H)(D===I||D.__eeOnceListener__===I)&&(2===F.length?U[W]=F[H?0:1]:F.splice(H,1));else(F===I||F.__eeOnceListener__===I)&&delete U[W];return this},B=function(W){var I,U,F,D,H;if(T.call(this,'__ee__')&&(D=this.__ee__[W],!!D))if('object'==typeof D){for(U=arguments.length,H=Array(U-1),I=1;I<U;++I)H[I-1]=arguments[I];for(D=D.slice(),I=0;F=D[I];++I)_.call(F,this,H)}else switch(arguments.length){case 1:C.call(D,this);break;case 2:C.call(D,this,arguments[1]);break;case 3:C.call(D,this,arguments[1],arguments[2]);break;default:for(U=arguments.length,H=Array(U-1),I=1;I<U;++I)H[I-1]=arguments[I];_.call(D,this,H);}},O={on:z,once:R,off:N,emit:B},A={on:v(z),once:v(R),off:v(N),emit:v(B)},M=L({},A),u.exports=p=function(W){return null==W?S(M):L(Object(W),A)},p.methods=O},function(u,p,f){'use strict';function k(L,T){if(!(L instanceof T))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function L(T,E){for(var R,z=0;z<E.length;z++)R=E[z],R.enumerable=R.enumerable||!1,R.configurable=!0,'value'in R&&(R.writable=!0),Object.defineProperty(T,R.key,R)}return function(T,E,z){return E&&L(T.prototype,E),z&&L(T,z),T}}(),C=f(6),S=function(L){return L&&L.__esModule?L:{default:L}}(C),P=function(){function L(T){k(this,L);var E,z;E=T.indexOf('://'),-1<E&&(T=new URL(T).pathname),z=this.parse(T),this.path=T,this.directory=this.isDirectory(T)?T:z.dir+'/',this.filename=z.base,this.extension=z.ext.slice(1)}return _(L,[{key:'parse',value:function(E){return S.default.parse(E)}},{key:'isAbsolute',value:function(E){return S.default.isAbsolute(E||this.path)}},{key:'isDirectory',value:function(E){return'/'===E.charAt(E.length-1)}},{key:'resolve',value:function(E){return S.default.resolve(this.directory,E)}},{key:'relative',value:function(E){return S.default.relative(this.directory,E)}},{key:'splitPath',value:function(E){return this.splitPathRe.exec(E).slice(1)}},{key:'toString',value:function(){return this.path}}]),L}();p.default=P,u.exports=p['default']},function(u,p,f){'use strict';Object.defineProperty(p,'__esModule',{value:!0}),p.replaceBase=function(E,z){var R,N;E&&(N=(0,P.qs)(E,'head'),R=(0,P.qs)(N,'base'),!R&&(R=E.createElement('base'),N.insertBefore(R,N.firstChild)),R.setAttribute('href',z.url))},p.replaceCanonical=function(E,z){var R,N,B=z.url;E&&(R=(0,P.qs)(E,'head'),N=(0,P.qs)(R,'link[rel=\'canonical\']'),N?N.setAttribute('href',B):(N=E.createElement('link'),N.setAttribute('rel','canonical'),N.setAttribute('href',B),R.appendChild(N)))},p.replaceLinks=function(E,z){for(var R=E.querySelectorAll('a[href]'),N=(0,P.qs)(E.ownerDocument,'base'),B=N?N.href:void 0,O=function(M){var W=M.getAttribute('href');if(0!==W.indexOf('mailto:')){var I=-1<W.indexOf('://'),U=new T.default(W,B);I?M.setAttribute('target','_blank'):M.onclick=function(){return U&&U.hash?z(U.Path.path+U.hash):U?z(U.Path.path):z(W),!1}}}.bind(this),A=0;A<R.length;A++)O(R[A])},p.substitute=function(E,z,R){return z.forEach(function(N,B){N&&R[B]&&(E=E.replace(new RegExp(N,'g'),R[B]))}),E};var P=f(0),L=f(5),T=function(E){return E&&E.__esModule?E:{default:E}}(L)},function(u,p,f){'use strict';function v(E){return E&&E.__esModule?E:{default:E}}function k(E,z){if(!(E instanceof z))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function E(z,R){for(var B,N=0;N<R.length;N++)B=R[N],B.enumerable=B.enumerable||!1,B.configurable=!0,'value'in B&&(B.writable=!0),Object.defineProperty(z,B.key,B)}return function(z,R,N){return R&&E(z.prototype,R),N&&E(z,N),z}}(),C=f(3),S=v(C),P=f(6),L=v(P),T=function(){function E(z,R){k(this,E);var N=-1<z.indexOf('://'),B=z;if(this.Url=void 0,this.href=z,this.protocol='',this.origin='',this.hash='',this.hash='',this.search='',this.base=R,!N&&!1!==R&&'string'!=typeof R&&window&&window.location&&(this.base=window.location.href),N||this.base)try{this.Url=this.base?new URL(z,this.base):new URL(z),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,B=this.Url.pathname}catch(O){this.Url=void 0}this.Path=new S.default(B),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}return _(E,[{key:'path',value:function(){return this.Path}},{key:'resolve',value:function(R){var B,N=-1<R.indexOf('://');return N?R:(B=L.default.resolve(this.directory,R),this.origin+B)}},{key:'relative',value:function(R){return L.default.relative(R,this.directory)}},{key:'toString',value:function(){return this.href}}]),E}();p.default=T,u.exports=p['default']},function(u,p,f){'use strict';(function(v){function k(P){if('string'!=typeof P)throw new TypeError('Path must be a string. Received '+P)}function _(P,L){for(var R,T='',E=-1,z=0,N=0;N<=P.length;++N){if(N<P.length)R=P.charCodeAt(N);else if(47===R)break;else R=47;if(47===R){if(E==N-1||1==z);else if(E!=N-1&&2==z){if(2>T.length||46!==T.charCodeAt(T.length-1)||46!==T.charCodeAt(T.length-2))if(2<T.length){for(var B=T.length-1,O=B;0<=O&&47!==T.charCodeAt(O);--O);if(O!=B){T=-1==O?'':T.slice(0,O),E=N,z=0;continue}}else if(2===T.length||1===T.length){T='',E=N,z=0;continue}L&&(0<T.length?T+='/..':T='..')}else 0<T.length?T+='/'+P.slice(E+1,N):T=P.slice(E+1,N);E=N,z=0}else 46===R&&-1!=z?++z:z=-1}return T}function C(P,L){var T=L.dir||L.root,E=L.base||(L.name||'')+(L.ext||'');return T?T===L.root?T+E:T+P+E:E}if(!v)var v={cwd:function(){return'/'}};var S={resolve:function(){for(var E,L='',T=!1,z=arguments.length-1;-1<=z&&!T;z--){var R;(0<=z?R=arguments[z]:(void 0==E&&(E=v.cwd()),R=E),k(R),0!==R.length)&&(L=R+'/'+L,T=47===R.charCodeAt(0))}return L=_(L,!T),T?0<L.length?'/'+L:'/':0<L.length?L:'.'},normalize:function(L){if(k(L),0===L.length)return'.';var T=47===L.charCodeAt(0),E=47===L.charCodeAt(L.length-1);return L=_(L,!T),0!==L.length||T||(L='.'),0<L.length&&E&&(L+='/'),T?'/'+L:L},isAbsolute:function(L){return k(L),0<L.length&&47===L.charCodeAt(0)},join:function(){if(0===arguments.length)return'.';for(var L,E,T=0;T<arguments.length;++T)E=arguments[T],k(E),0<E.length&&(void 0==L?L=E:L+='/'+E);return void 0===L?'.':S.normalize(L)},relative:function(L,T){if(k(L),k(T),L===T)return'';if(L=S.resolve(L),T=S.resolve(T),L===T)return'';for(var E=1;E<L.length&&47===L.charCodeAt(E);++E);for(var z=L.length,R=z-E,N=1;N<T.length&&47===T.charCodeAt(N);++N);for(var B=T.length,O=B-N,A=R<O?R:O,M=-1,W=0;W<=A;++W){if(W==A){if(O>A){if(47===T.charCodeAt(N+W))return T.slice(N+W+1);if(0==W)return T.slice(N+W)}else R>A&&(47===L.charCodeAt(E+W)?M=W:0==W&&(M=0));break}var I=L.charCodeAt(E+W),U=T.charCodeAt(N+W);if(I!==U)break;else 47===I&&(M=W)}var F='';for(W=E+M+1;W<=z;++W)(W===z||47===L.charCodeAt(W))&&(F+=0===F.length?'..':'/..');return 0<F.length?F+T.slice(N+M):(N+=M,47===T.charCodeAt(N)&&++N,T.slice(N))},_makeLong:function(L){return L},dirname:function(L){if(k(L),0===L.length)return'.';for(var T=L.charCodeAt(0),E=47===T,z=-1,R=!0,N=L.length-1;1<=N;--N)if(T=L.charCodeAt(N),47!==T)R=!1;else if(!R){z=N;break}return-1===z?E?'/':'.':E&&1===z?'//':L.slice(0,z)},basename:function(L,T){if(T!==void 0&&'string'!=typeof T)throw new TypeError('"ext" argument must be a string');k(L);var E=0,z=-1,R=!0,N;if(void 0!==T&&0<T.length&&T.length<=L.length){if(T.length===L.length&&T===L)return'';var B=T.length-1,O=-1;for(N=L.length-1;0<=N;--N){var A=L.charCodeAt(N);if(47!==A)-1==O&&(R=!1,O=N+1),0<=B&&(A===T.charCodeAt(B)?-1==--B&&(z=N):(B=-1,z=O));else if(!R){E=N+1;break}}return E===z?z=O:-1===z&&(z=L.length),L.slice(E,z)}for(N=L.length-1;0<=N;--N)if(47!==L.charCodeAt(N))-1==z&&(R=!1,z=N+1);else if(!R){E=N+1;break}return-1===z?'':L.slice(E,z)},extname:function(L){k(L);for(var O,T=-1,E=0,z=-1,R=!0,N=0,B=L.length-1;0<=B;--B){if(O=L.charCodeAt(B),47===O){if(!R){E=B+1;break}continue}-1==z&&(R=!1,z=B+1),46===O?-1==T?T=B:1!=N&&(N=1):-1!==T&&(N=-1)}return-1===T||-1===z||0==N||1==N&&T===z-1&&T===E+1?'':L.slice(T,z)},format:function(L){if(null===L||'object'!=typeof L)throw new TypeError('Parameter "pathObject" must be an object, not '+typeof L);return C('/',L)},parse:function(L){k(L);var T={root:'',dir:'',base:'',ext:'',name:''};if(0===L.length)return T;var R,E=L.charCodeAt(0),z=47===E;z?(T.root='/',R=1):R=0;for(var N=-1,B=0,O=-1,A=!0,M=L.length-1,W=0;M>=R;--M){if(E=L.charCodeAt(M),47===E){if(!A){B=M+1;break}continue}-1==O&&(A=!1,O=M+1),46===E?-1==N?N=M:1!=W&&(W=1):-1!=N&&(W=-1)}return-1==N||-1==O||0==W||1==W&&N==O-1&&N==B+1?-1!=O&&(0==B&&z?T.base=T.name=L.slice(1,O):T.base=T.name=L.slice(B,O)):(0==B&&z?(T.name=L.slice(1,N),T.base=L.slice(1,O)):(T.name=L.slice(B,N),T.base=L.slice(B,O)),T.ext=L.slice(N,O)),0<B?T.dir=L.slice(0,B-1):z&&(T.dir='/'),T},sep:'/',delimiter:':',posix:null};u.exports=S}).call(p,f(48))},function(u,p,f){'use strict';function v(O){return O&&O.__esModule?O:{default:O}}function k(O,A){if(!(O instanceof A))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function O(A,M){for(var I,W=0;W<M.length;W++)I=M[W],I.enumerable=I.enumerable||!1,I.configurable=!0,'value'in I&&(I.writable=!0),Object.defineProperty(A,I.key,I)}return function(A,M,W){return M&&O(A.prototype,M),W&&O(A,W),A}}(),C=f(2),S=v(C),P=f(0),L=f(1),T=v(L),E=f(8),z=v(E),R=f(4),N=['keydown','keyup','keypressed','mouseup','mousedown','click','touchend','touchstart'],B=function(){function O(A,M,W,I){var U=this;if(k(this,O),this.epubcfi=new T.default,this.document=A,this.pageStyle=I,this.documentElement=this.document.documentElement,this.content=M||this.document.body,this.window=this.document.defaultView,this.pageStyle){var F='';Object.keys(this.pageStyle).forEach(function(V){var X=U.pageStyle[V];F+=V+' {',Object.keys(X).forEach(function(Y){F+=Y+': '+X[Y]+';'}),F+='}'});var D=this.documentElement.head||this.documentElement.getElementsByTagName('head')[0],H=document.createElement('style');H.type='text/css',H.styleSheet?H.styleSheet.cssText=F:H.appendChild(document.createTextNode(F)),D.appendChild(H)}this._size={width:0,height:0},this.cfiBase=W||'',this.listeners()}return _(O,[{key:'width',value:function(M){var W=this.content;return M&&(0,P.isNumber)(M)&&(M+='px'),M&&(W.style.width=M),this.window.getComputedStyle(W).width}},{key:'height',value:function(M){var W=this.content;return M&&(0,P.isNumber)(M)&&(M+='px'),M&&(W.style.height=M),this.window.getComputedStyle(W).height}},{key:'contentWidth',value:function(M){var W=this.content||this.document.body;return M&&(0,P.isNumber)(M)&&(M+='px'),M&&(W.style.width=M),this.window.getComputedStyle(W).width}},{key:'contentHeight',value:function(M){var W=this.content||this.document.body;return M&&(0,P.isNumber)(M)&&(M+='px'),M&&(W.style.height=M),this.window.getComputedStyle(W).height}},{key:'textWidth',value:function(){var M,W=this.document.createRange(),I=this.content||this.document.body;return W.selectNodeContents(I),M=W.getBoundingClientRect().width+5,M}},{key:'textHeight',value:function(){var M,W=this.document.createRange(),I=this.content||this.document.body;return W.selectNodeContents(I),M=W.getBoundingClientRect().height,M}},{key:'scrollWidth',value:function(){var M=this.documentElement.scrollWidth;return M}},{key:'scrollHeight',value:function(){var M=this.documentElement.scrollHeight;return M}},{key:'overflow',value:function(M){return M&&(this.documentElement.style.overflow=M),this.window.getComputedStyle(this.documentElement).overflow}},{key:'overflowX',value:function(M){return M&&(this.documentElement.style.overflowX=M),this.window.getComputedStyle(this.documentElement).overflowX}},{key:'overflowY',value:function(M){return M&&(this.documentElement.style.overflowY=M),this.window.getComputedStyle(this.documentElement).overflowY}},{key:'css',value:function(M,W,I){var U=this.content||this.document.body;return W&&U.style.setProperty(M,W,I?'important':''),this.window.getComputedStyle(U)[M]}},{key:'viewport',value:function(M){var V,X,Y,J,Z,Q,K=this.document.querySelector('meta[name=\'viewport\']'),G='';if(K&&K.hasAttribute('content')){var $=K.getAttribute('content'),ee=$.match(/width\s*=\s*([^,]*)/g),te=$.match(/height\s*=\s*([^,]*)/g),ne=$.match(/initial-scale\s*=\s*([^,]*)/g),ae=$.match(/minimum-scale\s*=\s*([^,]*)/g),ie=$.match(/maximum-scale\s*=\s*([^,]*)/g),se=$.match(/user-scalable\s*=\s*([^,]*)/g);ee[1]&&(V=ee[1]),te[1]&&(X=te[1]),ne[1]&&(Y=ne[1]),ae[1]&&(J=ae[1]),ie[1]&&(Z=ie[1]),se[1]&&(Q=se[1])}return M&&(G+='width='+(M.width||V),G+=', height='+(M.height||X),(M.scale||Y)&&(G+=', initial-scale='+(M.scale||Y)),(M.scalable||Q)&&(G+=', minimum-scale='+(M.scale||J),G+=', maximum-scale='+(M.scale||Z),G+=', user-scalable='+(M.scalable||Q)),!K&&(K=this.document.createElement('meta'),K.setAttribute('name','viewport'),this.document.querySelector('head').appendChild(K)),K.setAttribute('content',G)),{width:parseInt(V),height:parseInt(X)}}},{key:'expand',value:function(){this.emit('expand')}},{key:'listeners',value:function(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners(),this.linksHandler()}},{key:'removeListeners',value:function(){this.removeEventListeners(),this.removeSelectionListeners()}},{key:'resizeListeners',value:function(){var M,W;clearTimeout(this.expanding),M=this.scrollWidth(),W=this.scrollHeight(),(M!=this._size.width||W!=this._size.height)&&(this._size={width:M,height:W},this.emit('resize',this._size)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}},{key:'mediaQueryListeners',value:function(){for(var M=this.document.styleSheets,W=function(H){H.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),I=0;I<M.length;I+=1){var U;try{U=M[I].cssRules}catch(H){return}if(!U)return;for(var F=0;F<U.length;F+=1)if(U[F].media){var D=this.window.matchMedia(U[F].media.mediaText);D.addListener(W)}}}},{key:'observe',value:function(M){var W=this,I=new MutationObserver(function(){W._expanding&&W.expand()});return I.observe(M,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),I}},{key:'imageLoadListeners',value:function(){for(var I,W=this.document.querySelectorAll('img'),U=0;U<W.length;U++)I=W[U],'undefined'!=typeof I.naturalWidth&&0===I.naturalWidth&&(I.onload=this.expand.bind(this))}},{key:'fontLoadListeners',value:function(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.expand()}.bind(this))}},{key:'root',value:function(){return this.document?this.document.documentElement:null}},{key:'locationOf',value:function(M,W){var I,U={left:0,top:0};if(this.document){if(this.epubcfi.isCfiString(M)){var F=new T.default(M).toRange(this.document,W);F&&(F.startContainer.nodeType===Node.ELEMENT_NODE?(I=F.startContainer.getBoundingClientRect(),U.left=I.left,U.top=I.top):F.collapsed?I=F.getClientRects()[0]:I=F.getBoundingClientRect())}else if('string'==typeof M&&-1<M.indexOf('#')){var D=M.substring(M.indexOf('#')+1),H=this.document.getElementById(D);H&&(I=H.getBoundingClientRect())}return I&&(U.left=I.left,U.top=I.top),U}}},{key:'addStylesheet',value:function(M){return new Promise(function(W){var U,F=!1;return this.document?(U=this.document.querySelector('link[href=\''+M+'\']'),U?void W(!0):void(U=this.document.createElement('link'),U.type='text/css',U.rel='stylesheet',U.href=M,U.onload=U.onreadystatechange=function(){F||this.readyState&&'complete'!=this.readyState||(F=!0,setTimeout(function(){W(!0)},1))},this.document.head.appendChild(U))):void W(!1)}.bind(this))}},{key:'addStylesheetRules',value:function(M){var W,I,U='epubjs-inserted-css';if(this.document&&M&&0!==M.length)if(W=this.document.getElementById('#'+U),W||(W=this.document.createElement('style'),W.id=U),this.document.head.appendChild(W),I=W.sheet,'[object Array]'===Object.prototype.toString.call(M))for(var F=0,D=M.length;F<D;F++){var H=1,V=M[F],X=M[F][0],Y='';'[object Array]'===Object.prototype.toString.call(V[1][0])&&(V=V[1],H=0);for(var Z,J=V.length;H<J;H++)Z=V[H],Y+=Z[0]+':'+Z[1]+(Z[2]?' !important':'')+';\n';I.insertRule(X+'{'+Y+'}',I.cssRules.length)}else{var Q=Object.keys(M);Q.forEach(function(K){var G=M[K],$=Object.keys(G),ee=$.map(function(te){return te+':'+G[te]}).join(';');I.insertRule(K+'{'+ee+'}',I.cssRules.length)})}}},{key:'addScript',value:function(M){return new Promise(function(W){var U,F=!1;return this.document?void(U=this.document.createElement('script'),U.type='text/javascript',U.async=!0,U.src=M,U.onload=U.onreadystatechange=function(){F||this.readyState&&'complete'!=this.readyState||(F=!0,setTimeout(function(){W(!0)},1))},this.document.head.appendChild(U)):void W(!1)}.bind(this))}},{key:'addClass',value:function(M){var W;this.document&&(W=this.content||this.document.body,W.classList.add(M))}},{key:'removeClass',value:function(M){var W;this.document&&(W=this.content||this.document.body,W.classList.remove(M))}},{key:'addEventListeners',value:function(){this.document&&N.forEach(function(M){this.document.addEventListener(M,this.triggerEvent.bind(this),!1)},this)}},{key:'removeEventListeners',value:function(){this.document&&N.forEach(function(M){this.document.removeEventListener(M,this.triggerEvent,!1)},this)}},{key:'triggerEvent',value:function(M){this.emit(M.type,M)}},{key:'addSelectionListeners',value:function(){this.document&&this.document.addEventListener('selectionchange',this.onSelectionChange.bind(this),!1)}},{key:'removeSelectionListeners',value:function(){this.document&&this.document.removeEventListener('selectionchange',this.onSelectionChange,!1)}},{key:'onSelectionChange',value:function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var W=this.window.getSelection();this.triggerSelectedEvent(W)}.bind(this),500)}},{key:'triggerSelectedEvent',value:function(M){var W,I;M&&0<M.rangeCount&&(W=M.getRangeAt(0),!W.collapsed&&(I=new T.default(W,this.cfiBase).toString(),this.emit('selected',I),this.emit('selectedRange',W)))}},{key:'range',value:function(M,W){var I=new T.default(M);return I.toRange(this.document,W)}},{key:'cfiFromRange',value:function(M,W){return new T.default(M,this.cfiBase,W).toString()}},{key:'cfiFromNode',value:function(M,W){return new T.default(M,this.cfiBase,W).toString()}},{key:'map',value:function(M){var A=new z.default(M);return A.section()}},{key:'size',value:function(M,W){0<=M&&this.width(M),0<=W&&this.height(W),this.css('margin','0'),this.css('box-sizing','border-box')}},{key:'columns',value:function(M,W,I,U){var F=(0,P.prefixed)('column-axis'),D=(0,P.prefixed)('column-gap'),H=(0,P.prefixed)('column-width'),V=(0,P.prefixed)('column-fill');this.width(M),this.height(W),this.viewport({width:M,height:W,scale:1,scalable:'no'}),this.css('overflow-y','hidden'),this.css('margin','0',!0),this.css('padding','0',!0),this.css('box-sizing','border-box'),this.css('max-width','inherit'),this.css(F,'horizontal'),this.css(V,'auto'),this.css(D,U+'px'),this.css(H,I+'px')}},{key:'scaler',value:function(M,W,I){var F='';this.css('transform-origin','top left'),(0<=W||0<=I)&&(F=' translate('+(W||0)+'px, '+(I||0)+'px )'),this.css('transform','scale('+M+')'+F)}},{key:'fit',value:function(M,W){var I=this.viewport(),U=M/I.width,F=W/I.height,D=U<F?U:F,H=(W-I.height*D)/2;this.width(M),this.height(W),this.overflow('hidden'),this.viewport({scale:1}),this.scaler(D,0,H),this.css('background-color','transparent')}},{key:'mapPage',value:function(M,W,I,U,F){var D=new z.default(W,F);return D.page(this,M,I,U)}},{key:'linksHandler',value:function(){var M=this;(0,R.replaceLinks)(this.content,function(W){M.emit('link',W)})}},{key:'destroy',value:function(){this.observer&&this.observer.disconnect(),this.removeListeners()}}],[{key:'listenedEvents',get:function(){return N}}]),O}();(0,S.default)(B.prototype),p.default=B,u.exports=p['default']},function(u,p,f){'use strict';function k(L,T){if(!(L instanceof T))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function L(T,E){for(var R,z=0;z<E.length;z++)R=E[z],R.enumerable=R.enumerable||!1,R.configurable=!0,'value'in R&&(R.writable=!0),Object.defineProperty(T,R.key,R)}return function(T,E,z){return E&&L(T.prototype,E),z&&L(T,z),T}}(),C=f(1),S=function(L){return L&&L.__esModule?L:{default:L}}(C),P=function(){function L(T,E){k(this,L),this.layout=T,this.horizontal='paginated'===this.layout.flow,this._dev=E}return _(L,[{key:'section',value:function(E){var z=this.findRanges(E),R=this.rangeListToCfiList(E.section.cfiBase,z);return R}},{key:'page',value:function(E,z,R,N){var O,B=E&&E.document&&E.document.body;if(B){if(O=this.rangePairToCfiPair(z,{start:this.findStart(B,R,N),end:this.findEnd(B,R,N)}),!0===this._dev){var A=E.document,M=new S.default(O.start).toRange(A),W=new S.default(O.end).toRange(A),I=A.defaultView.getSelection(),U=A.createRange();I.removeAllRanges(),U.setStart(M.startContainer,M.startOffset),U.setEnd(W.endContainer,W.endOffset),I.addRange(U)}return O}}},{key:'walk',value:function(E,z){for(var N,B,R=document.createTreeWalker(E,NodeFilter.SHOW_TEXT,{acceptNode:function(A){return 0<A.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1);(N=R.nextNode())&&(B=z(N),!B););return B}},{key:'findRanges',value:function(E){for(var M,W,z=[],R=E.contents.scrollWidth(),N=Math.ceil(R/this.layout.spreadWidth),B=N*this.layout.divisor,O=this.layout.columnWidth,A=this.layout.gap,I=0;I<B.pages;I++)M=(O+A)*I,W=O*(I+1)+A*I,z.push({start:this.findStart(E.document.body,M,W),end:this.findEnd(E.document.body,M,W)});return z}},{key:'findStart',value:function(E,z,R){for(var O,A,N=this,B=[E],M=E;B.length;)if(O=B.shift(),A=this.walk(O,function(W){var I,U,F,D;return(W.nodeType==Node.TEXT_NODE?(D=document.createRange(),D.selectNodeContents(W),F=D.getBoundingClientRect()):F=W.getBoundingClientRect(),I=N.horizontal?F.left:F.top,U=N.horizontal?F.right:F.bottom,I>=z&&I<=R)?W:U>z?W:void(M=W,B.push(W))}),A)return this.findTextStartRange(A,z,R);return this.findTextStartRange(M,z,R)}},{key:'findEnd',value:function(E,z,R){for(var O,M,N=this,B=[E],A=E;B.length;)if(O=B.shift(),M=this.walk(O,function(W){var I,U,F,D;return(W.nodeType==Node.TEXT_NODE?(D=document.createRange(),D.selectNodeContents(W),F=D.getBoundingClientRect()):F=W.getBoundingClientRect(),I=N.horizontal?F.left:F.top,U=N.horizontal?F.right:F.bottom,I>R&&A)?A:U>R?W:void(A=W,B.push(W))}),M)return this.findTextEndRange(M,z,R);return this.findTextEndRange(A,z,R)}},{key:'findTextStartRange',value:function(E,z){for(var B,O,A,N=this.splitTextNodeIntoRanges(E),M=0;M<N.length;M++)if(B=N[M],O=B.getBoundingClientRect(),A=this.horizontal?O.left:O.top,A>=z)return B;return N[0]}},{key:'findTextEndRange',value:function(E,z,R){for(var B,O,A,M,W,N=this.splitTextNodeIntoRanges(E),I=0;I<N.length;I++){if(O=N[I],A=O.getBoundingClientRect(),M=this.horizontal?A.left:A.top,W=this.horizontal?A.right:A.bottom,M>R&&B)return B;if(W>R)return O;B=O}return N[N.length-1]}},{key:'splitTextNodeIntoRanges',value:function(E,z){var O,R=[],N=E.textContent||'',B=N.trim(),A=E.ownerDocument,M=z||' ',W=B.indexOf(M);if(-1===W||E.nodeType!=Node.TEXT_NODE)return O=A.createRange(),O.selectNodeContents(E),[O];for(O=A.createRange(),O.setStart(E,0),O.setEnd(E,W),R.push(O),O=!1;-1!=W;)W=B.indexOf(M,W+1),0<W&&(O&&(O.setEnd(E,W),R.push(O)),O=A.createRange(),O.setStart(E,W+1));return O&&(O.setEnd(E,B.length),R.push(O)),R}},{key:'rangePairToCfiPair',value:function(E,z){var R=z.start,N=z.end;R.collapse(!0),N.collapse(!1);var B=new S.default(R,E).toString(),O=new S.default(N,E).toString();return{start:B,end:O}}},{key:'rangeListToCfiList',value:function(E,z){for(var N,R=[],B=0;B<z.length;B++)N=this.rangePairToCfiPair(E,z[B]),R.push(N);return R}}]),L}();p.default=P,u.exports=p['default']},function(u,p){'use strict';function v(C,S){if(!(C instanceof S))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var k=function(){function C(S,P){for(var T,L=0;L<P.length;L++)T=P[L],T.enumerable=T.enumerable||!1,T.configurable=!0,'value'in T&&(T.writable=!0),Object.defineProperty(S,T.key,T)}return function(S,P,L){return P&&C(S.prototype,P),L&&C(S,L),S}}(),_=function(){function C(S){v(this,C),this.context=S||this,this.hooks=[]}return k(C,[{key:'register',value:function(){for(var P=0;P<arguments.length;++P)if('function'==typeof arguments[P])this.hooks.push(arguments[P]);else for(var L=0;L<arguments[P].length;++L)this.hooks.push(arguments[P][L])}},{key:'trigger',value:function(){var P=arguments,L=this.context,T=[];return this.hooks.forEach(function(E){var z=E.apply(L,P);z&&'function'==typeof z.then&&T.push(z)}),Promise.all(T)}},{key:'list',value:function(){return this.hooks}},{key:'clear',value:function(){return this.hooks=[]}}]),C}();p.default=_,u.exports=p['default']},function(u,p,f){'use strict';function v(P,L){if(!(P instanceof L))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0}),p.Task=void 0;var k=function(){function P(L,T){for(var z,E=0;E<T.length;E++)z=T[E],z.enumerable=z.enumerable||!1,z.configurable=!0,'value'in z&&(z.writable=!0),Object.defineProperty(L,z.key,z)}return function(L,T,E){return T&&P(L.prototype,T),E&&P(L,E),L}}(),_=f(0),C=function(){function P(L){v(this,P),this._q=[],this.context=L,this.tick=_.requestAnimationFrame,this.running=!1,this.paused=!1}return k(P,[{key:'enqueue',value:function(){var T,E,z,R=[].shift.call(arguments),N=arguments;if(!R)throw new Error('No Task Provided');return'function'==typeof R?(T=new _.defer,E=T.promise,z={task:R,args:N,deferred:T,promise:E}):z={promise:R},this._q.push(z),!1!=this.paused||this.running||this.run(),z.promise}},{key:'dequeue',value:function(){var T,E,z;if(this._q.length&&!this.paused){if(T=this._q.shift(),E=T.task,E)return z=E.apply(this.context,T.args),z&&'function'==typeof z.then?z.then(function(){T.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){T.deferred.reject.apply(this.context,arguments)}.bind(this)):(T.deferred.resolve.apply(this.context,z),T.promise);if(T.promise)return T.promise}else return T=new _.defer,T.deferred.resolve(),T.promise}},{key:'dump',value:function(){for(;this._q.length;)this.dequeue()}},{key:'run',value:function(){var T=this;return this.running||(this.running=!0,this.defered=new _.defer),this.tick.call(window,function(){T._q.length?T.dequeue().then(function(){this.run()}.bind(T)):(T.defered.resolve(),T.running=void 0)}),!0==this.paused&&(this.paused=!1),this.defered.promise}},{key:'flush',value:function(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0}},{key:'clear',value:function(){this._q=[],this.running=!1,this.paused=!0}},{key:'length',value:function(){return this._q.length}},{key:'pause',value:function(){this.paused=!0}}]),P}();p.default=C,p.Task=function P(L,T,E){return v(this,P),function(){var z=this,R=arguments||[];return new Promise(function(N,B){R.push(function(M,W){!M&&W?B(W):N(M)}),L.apply(E||z,R)})}}},function(u,p,f){'use strict';Object.defineProperty(p,'__esModule',{value:!0});var _=f(0),C=f(3),S=function(P){return P&&P.__esModule?P:{default:P}}(C);p.default=function(P,L,T,E){function z(I){O.reject(I)}function R(){if(this.readyState===XMLHttpRequest.DONE){var I=!1;if((''===this.responseType||'document'===this.responseType)&&(I=this.responseXML),200===this.status||I){var U;if(!this.response&&!I)return O.reject({status:this.status,message:'Empty Response',stack:new Error().stack}),O.promise;if(403===this.status)return O.reject({status:this.status,response:this.response,message:'Forbidden',stack:new Error().stack}),O.promise;U=I?this.responseXML:(0,_.isXml)(L)?(0,_.parse)(this.response,'text/xml'):'xhtml'==L?(0,_.parse)(this.response,'application/xhtml+xml'):'html'==L||'htm'==L?(0,_.parse)(this.response,'text/html'):'json'==L?JSON.parse(this.response):'blob'==L?N?this.response:new Blob([this.response]):this.response,O.resolve(U)}else O.reject({status:this.status,message:this.response,stack:new Error().stack})}}var W,N='undefined'!=typeof window&&window.URL,B=N?'blob':'arraybuffer',O=new _.defer,A=new XMLHttpRequest,M=XMLHttpRequest.prototype;for(W in'overrideMimeType'in M||Object.defineProperty(M,'overrideMimeType',{value:function(){}}),T&&(A.withCredentials=!0),A.onreadystatechange=R,A.onerror=z,A.open('GET',P,!0),E)A.setRequestHeader(W,E[W]);return'json'==L&&A.setRequestHeader('Accept','application/json'),L||(L=new S.default(P).extension),'blob'==L&&(A.responseType=B),(0,_.isXml)(L)&&A.overrideMimeType('text/xml'),'xhtml'==L,'html'!=L&&'htm'!=L,'binary'==L&&(A.responseType='arraybuffer'),A.send(),O.promise},u.exports=p['default']},function(u,p,f){'use strict';function v(M){return M&&M.__esModule?M:{default:M}}function k(M,W){if(!(M instanceof W))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function M(W,I){for(var F,U=0;U<I.length;U++)F=I[U],F.enumerable=F.enumerable||!1,F.configurable=!0,'value'in F&&(F.writable=!0),Object.defineProperty(W,F.key,F)}return function(W,I,U){return I&&M(W.prototype,I),U&&M(W,U),W}}(),C=f(2),S=v(C),P=f(0),L=f(8),T=v(L),E=f(10),z=v(E),R=f(25),N=v(R),B=f(26),O=v(B),A=function(){function M(W){k(this,M),this.name='default',this.View=W.view,this.request=W.request,this.renditionQueue=W.queue,this.q=new z.default(this),this.settings=(0,P.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:'vertical',ignoreClass:''}),(0,P.extend)(this.settings,W.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,layout:this.layout,width:0,height:0,pageStyle:this.settings.pageStyle}}return _(M,[{key:'render',value:function(I,U){this.stage=new N.default({width:U.width,height:U.height,overflow:this.settings.overflow,hidden:this.settings.hidden,axis:this.settings.axis}),this.stage.attachTo(I),this.container=this.stage.getContainer(),this.views=new O.default(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout()}},{key:'addEventListeners',value:function(){var I;window.addEventListener('unload',function(){this.destroy()}.bind(this)),I=this.settings.height?this.container:window,I.addEventListener('scroll',this.onScroll.bind(this))}},{key:'removeEventListeners',value:function(){var I;I=this.settings.height?this.container:window,I.removeEventListener('scroll',this.onScroll.bind(this))}},{key:'destroy',value:function(){this.removeEventListeners(),this.views.each(function(I){I.destroy()}),this.stage.destroy()}},{key:'onResized',value:function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.resize()}.bind(this),150)}},{key:'resize',value:function(I,U){this.q.clear(),this._stageSize=this.stage.size(I,U),this._bounds=this.bounds(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.views.each(function(F){F.size(this._stageSize.width,this._stageSize.height)}.bind(this)),this.emit('resized',{width:this.stage.width,height:this.stage.height})}},{key:'createView',value:function(I){return new this.View(I,this.viewSettings)}},{key:'display',value:function(I,U){var F=new P.defer,D=F.promise,H=this.views.find(I);if(H&&U){var V=H.locationOf(U);return this.moveTo(V),F.resolve(),D}return this.clear(),this.add(I).then(function(X){if(U){var Y=X.locationOf(U);this.moveTo(Y)}}.bind(this)).then(function(){var X;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(X=I.next(),X))return this.add(X)}.bind(this)).then(function(){this.views.show(),F.resolve()}.bind(this)),D}},{key:'afterDisplayed',value:function(I){this.emit('added',I)}},{key:'afterResized',value:function(I){this.emit('resize',I.section)}},{key:'moveTo',value:function(I){var U=0,F=0;'vertical'===this.settings.axis?F=I.top:(U=Math.floor(I.left/this.layout.delta)*this.layout.delta,U+this.layout.delta>this.container.scrollWidth&&(U=this.container.scrollWidth-this.layout.delta)),this.scrollTo(U,F,!0)}},{key:'add',value:function(I){var U=this.createView(I);return this.views.append(U),U.onDisplayed=this.afterDisplayed.bind(this),U.onResize=this.afterResized.bind(this),U.display(this.request)}},{key:'append',value:function(I){var U=this.createView(I);return this.views.append(U),U.onDisplayed=this.afterDisplayed.bind(this),U.onResize=this.afterResized.bind(this),U.display(this.request)}},{key:'prepend',value:function(I){var U=this.createView(I);return this.views.prepend(U),U.onDisplayed=this.afterDisplayed.bind(this),U.onResize=this.afterResized.bind(this),U.display(this.request)}},{key:'next',value:function(){var W,I;if(this.views.length)return('horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,I=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,I<this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):I-this.layout.columnWidth===this.container.scrollWidth?(this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0),W=this.views.last().section.next()):W=this.views.last().section.next()):W=this.views.last().section.next(),W)?(this.clear(),this.append(W).then(function(){var U;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(U=W.next(),U))return this.append(U)}.bind(this)).then(function(){this.views.show()}.bind(this))):void 0}},{key:'prev',value:function(){var W,I;if(this.views.length)return('horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,I=this.container.scrollLeft,0<I?this.scrollBy(-this.layout.delta,0,!0):W=this.views.first().section.prev()):W=this.views.first().section.prev(),W)?(this.clear(),this.prepend(W).then(function(){var U;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(U=W.prev(),U))return this.prepend(U)}.bind(this)).then(function(){'horizontal'===this.settings.axis&&this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0),this.views.show()}.bind(this))):void 0}},{key:'current',value:function(){var I=this.visible();return I.length?I[I.length-1]:null}},{key:'clear',value:function(){this.views.hide(),this.scrollTo(0,0,!0),this.views.clear()}},{key:'currentLocation',value:function(){return this.location='vertical'===this.settings.axis?this.scrolledLocation():this.paginatedLocation(),this.location}},{key:'scrolledLocation',value:function(){var U,F,D,H,V,X,Y,I=this.visible(),J=this.container.getBoundingClientRect(),Z=J.height<window.innerHeight?J.height:window.innerHeight,Q=0;return this.settings.height||(Q=window.scrollY),1===I.length?(D=J.top-I[0].position().top+Q,V=D+Z,U=this.mapping.page(I[0].contents,I[0].section.cfiBase,D,V),{index:I[0].section.index,href:I[0].section.href,start:U.start,end:U.end}):1<I.length?(Y=I.length-1,D=J.top-I[0].position().top+Q,V=D+(J.top-I[0].position().bottom),H=J.top-I[Y].position().top+Q,X=Z-H,U=this.mapping.page(I[0].contents,I[0].section.cfiBase,D,V),F=this.mapping.page(I[Y].contents,I[Y].section.cfiBase,H,X),{index:I[Y].section.index,href:I[Y].section.href,start:U.start,end:F.end}):void 0}},{key:'paginatedLocation',value:function(){var U,F,D,H,V,X,J,I=this.visible(),Y=this.container.getBoundingClientRect();return 1===I.length?(U=Y.left-I[0].position().left,D=U+this.layout.spreadWidth+this.layout.gap,V=this.mapping.page(I[0].contents,I[0].section.cfiBase,U,D),{index:I[0].section.index,href:I[0].section.href,start:V.start,end:V.end}):1<I.length?(J=I.length-1,U=Y.left-I[0].position().left,D=U+this.layout.columnWidth+this.layout.gap/2,F=Y.left+this.layout.spreadWidth-I[J].position().left,H=F+this.layout.columnWidth+this.layout.gap/2,V=this.mapping.page(I[0].contents,I[0].section.cfiBase,U,D),X=this.mapping.page(I[J].contents,I[J].section.cfiBase,F,H),{index:I[J].section.index,href:I[J].section.href,start:V.start,end:X.end}):void 0}},{key:'isVisible',value:function(I,U,F,D){var H=I.position(),V=D||this.bounds();return'horizontal'===this.settings.axis&&H.right>V.left-U&&H.left<V.right+F||'vertical'===this.settings.axis&&H.bottom>V.top-U&&H.top<V.bottom+F}},{key:'visible',value:function(){for(var D,H,I=this.bounds(),U=this.views.displayed(),F=U.length,W=[],V=0;V<F;V++)H=U[V],D=this.isVisible(H,0,0,I),!0===D&&W.push(H);return W}},{key:'scrollBy',value:function(I,U,F){F&&(this.ignore=!0),this.settings.height?(I&&(this.container.scrollLeft+=I),U&&(this.container.scrollTop+=U)):window.scrollBy(I,U),this.scrolled=!0}},{key:'scrollTo',value:function(I,U,F){F&&(this.ignore=!0),this.settings.height?(this.container.scrollLeft=I,this.container.scrollTop=U):window.scrollTo(I,U),this.scrolled=!0}},{key:'onScroll',value:function(){var I,U;this.settings.height?(I=this.container.scrollTop,U=this.container.scrollLeft):(I=window.scrollY,U=window.scrollX),this.scrollTop=I,this.scrollLeft=U,this.ignore?this.ignore=!1:(console.log('scroll',U,I),this.emit('scroll',{top:I,left:U}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit('scrolled',{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}},{key:'bounds',value:function(){var W;return W=this.stage.bounds(),W}},{key:'applyLayout',value:function(I){this.layout=I,this.updateLayout(),this.mapping=new T.default(this.layout.props)}},{key:'updateLayout',value:function(){this.stage&&(this._stageSize=this.stage.size(),'vertical'===this.settings.axis?this.layout.calculate(this._stageSize.width,this._stageSize.height):(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta,this.stage.addStyleRules('iframe',[{'margin-right':this.layout.gap+'px'}])),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}},{key:'setLayout',value:function(I){this.viewSettings.layout=I,this.views&&this.views.each(function(U){U.setLayout(I)})}},{key:'updateFlow',value:function(I){var U='paginated'===I?'horizontal':'vertical';this.settings.axis=U,this.viewSettings.axis=U,this.settings.overflow='paginated'===I?'hidden':'auto'}},{key:'getContents',value:function(){var I=[];return this.views.each(function(U){I.push(U.contents)}),I}}]),M}();(0,S.default)(A.prototype),p.default=A,u.exports=p['default']},function(u,p,f){'use strict';function v(V){return V&&V.__esModule?V:{default:V}}function k(V,X){if(!(V instanceof X))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(V){return typeof V}:function(V){return V&&'function'==typeof Symbol&&V.constructor===Symbol&&V!==Symbol.prototype?'symbol':typeof V},C=function(){function V(X,Y){for(var Z,J=0;J<Y.length;J++)Z=Y[J],Z.enumerable=Z.enumerable||!1,Z.configurable=!0,'value'in Z&&(Z.writable=!0),Object.defineProperty(X,Z.key,Z)}return function(X,Y,J){return Y&&V(X.prototype,Y),J&&V(X,J),X}}(),S=f(2),P=v(S),L=f(0),T=f(9),E=v(T),z=f(1),R=v(z),N=f(10),B=v(N),O=f(23),A=v(O),M=f(8),W=v(M),I=f(33),U=v(I),F=f(7),D=v(F),H=function(){function V(X,Y){k(this,V),this.settings=(0,L.extend)(this.settings||{},{width:null,height:null,ignoreClass:'',manager:'default',view:'iframe',flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,script:null}),(0,L.extend)(this.settings,Y),'object'===_(this.settings.manager)&&(this.manager=this.settings.manager),this.viewSettings={ignoreClass:this.settings.ignoreClass},this.book=X,this.views=null,this.hooks={},this.hooks.display=new E.default(this),this.hooks.serialize=new E.default(this),this.hooks.content=new E.default(this),this.hooks.layout=new E.default(this),this.hooks.render=new E.default(this),this.hooks.show=new E.default(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new U.default(this),this.epubcfi=new R.default,this.q=new B.default(this),this.q.enqueue(this.book.opened),this.starting=new L.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}return C(V,[{key:'setManager',value:function(Y){this.manager=Y}},{key:'requireManager',value:function(Y){var J;return J='string'==typeof Y?'undefined'==typeof ePub?void 0:ePub.ViewManagers[Y]:Y,J}},{key:'requireView',value:function(Y){var J;return J='string'==typeof Y?'undefined'==typeof ePub?void 0:ePub.Views[Y]:Y,J}},{key:'start',value:function(){this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on('added',this.afterDisplayed.bind(this)),this.manager.on('resized',this.onResized.bind(this)),this.manager.on('scrolled',this.reportLocation.bind(this)),this.emit('started'),this.starting.resolve()}},{key:'attachTo',value:function(Y){return this.q.enqueue(function(){this.manager.render(Y,{width:this.settings.width,height:this.settings.height}),this.emit('attached')}.bind(this))}},{key:'display',value:function(Y){return this.q.enqueue(this._display,Y)}},{key:'_display',value:function(Y){if(this.book){var K,J=this.epubcfi.isCfiString(Y),Z=new L.defer,Q=Z.promise;return this.book.locations.length&&(0,L.isFloat)(Y)&&(Y=this.book.locations.cfiFromPercentage(Y)),K=this.book.spine.get(Y),K?this.manager.display(K,Y).then(function(){this.emit('displayed',K),this.reportLocation()}.bind(this)):(Z.reject(new Error('No Section Found')),Q)}}},{key:'afterDisplayed',value:function(Y){this.hooks.content.trigger(Y.contents,this),this.emit('rendered',Y.section)}},{key:'onResized',value:function(Y){this.location&&this.display(this.location.start),this.emit('resized',{width:Y.width,height:Y.height})}},{key:'moveTo',value:function(Y){this.manager.moveTo(Y)}},{key:'next',value:function(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:'prev',value:function(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:'determineLayoutProperties',value:function(Y){var J,Z=this.settings.layout||Y.layout||'reflowable',Q=this.settings.spread||Y.spread||'auto',K=this.settings.orientation||Y.orientation||'auto',G=this.settings.flow||Y.flow||'auto',$=Y.viewport||'',ee=this.settings.minSpreadWidth||Y.minSpreadWidth||800;return 0<=this.settings.width&&0<=this.settings.height&&($='width='+this.settings.width+', height='+this.settings.height+''),J={layout:Z,spread:Q,orientation:K,flow:G,viewport:$,minSpreadWidth:ee},J}},{key:'flow',value:function(Y){var J=Y;('scrolled-doc'===Y||'scrolled-continuous'===Y)&&(J='scrolled'),('auto'===Y||'paginated'===Y)&&(J='paginated'),this._layout&&this._layout.flow(J),this.manager&&this.manager.updateFlow(J)}},{key:'layout',value:function(Y){return Y&&(this._layout=new A.default(Y),this._layout.spread(Y.spread,this.settings.minSpreadWidth),this.mapping=new W.default(this._layout.props)),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}},{key:'spread',value:function(Y,J){this._layout.spread(Y,J),this.manager.isRendered()&&this.manager.updateLayout()}},{key:'reportLocation',value:function(){return this.q.enqueue(function(){var Y=this.manager.currentLocation();Y&&Y.then&&'function'==typeof Y.then?Y.then(function(J){this.location=J,this.percentage=this.book.locations.percentageFromCfi(J),null!=this.percentage&&(this.location.percentage=this.percentage),this.emit('locationChanged',this.location)}.bind(this)):Y&&(this.location=Y,this.percentage=this.book.locations.percentageFromCfi(Y),null!=this.percentage&&(this.location.percentage=this.percentage),this.emit('locationChanged',this.location))}.bind(this))}},{key:'currentLocation',value:function(){var Y=this.manager.currentLocation();if(Y&&Y.then&&'function'==typeof Y.then)Y.then(function(Z){var Q=this.book.locations.percentageFromCfi(Z);return null!=Q&&(Z.percentage=Q),Z}.bind(this));else if(Y){var J=this.book.locations.percentageFromCfi(Y);return null!=J&&(Y.percentage=J),Y}}},{key:'destroy',value:function(){this.manager&&this.manager.destroy(),this.book=void 0,this.views=null}},{key:'passEvents',value:function(Y){var J=D.default.listenedEvents;J.forEach(function(Z){Y.on(Z,this.triggerViewEvent.bind(this))}.bind(this)),Y.on('selected',this.triggerSelectedEvent.bind(this))}},{key:'triggerViewEvent',value:function(Y){this.emit(Y.type,Y)}},{key:'triggerSelectedEvent',value:function(Y){this.emit('selected',Y)}},{key:'range',value:function(Y,J){var Z=new R.default(Y),Q=this.manager.visible().filter(function(K){if(Z.spinePos===K.index)return!0});if(Q.length)return Q[0].range(Z,J)}},{key:'adjustImages',value:function(Y){return'pre-paginated'===this._layout.name?new Promise(function(J){J()}):(Y.addStylesheetRules({img:{'max-width':this._layout.columnWidth+'px !important','max-height':this._layout.height+'px !important','object-fit':'contain','page-break-inside':'avoid'}}),new Promise(function(J){setTimeout(function(){J()},1)}))}},{key:'getContents',value:function(){return this.manager?this.manager.getContents():[]}},{key:'handleLinks',value:function(Y){var J=this;Y.on('link',function(Z){var Q=J.book.path.relative(Z);J.display(Q)})}},{key:'injectStylesheet',value:function(Y){var Z=Y.createElement('link');Z.setAttribute('type','text/css'),Z.setAttribute('rel','stylesheet'),Z.setAttribute('href',this.settings.stylesheet),Y.getElementsByTagName('head')[0].appendChild(Z)}},{key:'injectScript',value:function(Y){var Z=Y.createElement('script');Z.setAttribute('type','text/javascript'),Z.setAttribute('src',this.settings.script),Z.textContent=' ',Y.getElementsByTagName('head')[0].appendChild(Z)}}]),V}();(0,P.default)(H.prototype),p.default=H,u.exports=p['default']},function(u){'use strict';var k={application:{ecmascript:['es','ecma'],javascript:'js',ogg:'ogx',pdf:'pdf',postscript:['ps','ai','eps','epsi','epsf','eps2','eps3'],'rdf+xml':'rdf',smil:['smi','smil'],'xhtml+xml':['xhtml','xht'],xml:['xml','xsl','xsd','opf','ncx'],zip:'zip','x-httpd-eruby':'rhtml','x-latex':'latex','x-maker':['frm','maker','frame','fm','fb','book','fbdoc'],'x-object':'o','x-shockwave-flash':['swf','swfl'],'x-silverlight':'scr','epub+zip':'epub','font-tdpfr':'pfr','inkml+xml':['ink','inkml'],json:'json','jsonml+json':'jsonml','mathml+xml':'mathml','metalink+xml':'metalink',mp4:'mp4s','omdoc+xml':'omdoc',oxps:'oxps','vnd.amazon.ebook':'azw',widget:'wgt','x-dtbook+xml':'dtb','x-dtbresource+xml':'res','x-font-bdf':'bdf','x-font-ghostscript':'gsf','x-font-linux-psf':'psf','x-font-otf':'otf','x-font-pcf':'pcf','x-font-snf':'snf','x-font-ttf':['ttf','ttc'],'x-font-type1':['pfa','pfb','pfm','afm'],'x-font-woff':'woff','x-mobipocket-ebook':['prc','mobi'],'x-mspublisher':'pub','x-nzb':'nzb','x-tgif':'obj','xaml+xml':'xaml','xml-dtd':'dtd','xproc+xml':'xpl','xslt+xml':'xslt','internet-property-stream':'acx','x-compress':'z','x-compressed':'tgz','x-gzip':'gz'},audio:{flac:'flac',midi:['mid','midi','kar','rmi'],mpeg:['mpga','mpega','mp2','mp3','m4a','mp2a','m2a','m3a'],mpegurl:'m3u',ogg:['oga','ogg','spx'],'x-aiff':['aif','aiff','aifc'],'x-ms-wma':'wma','x-wav':'wav',adpcm:'adp',mp4:'mp4a',webm:'weba','x-aac':'aac','x-caf':'caf','x-matroska':'mka','x-pn-realaudio-plugin':'rmp',xm:'xm',mid:['mid','rmi']},image:{gif:'gif',ief:'ief',jpeg:['jpeg','jpg','jpe'],pcx:'pcx',png:'png','svg+xml':['svg','svgz'],tiff:['tiff','tif'],'x-icon':'ico',bmp:'bmp',webp:'webp','x-pict':['pic','pct'],'x-tga':'tga','cis-cod':'cod'},text:{'cache-manifest':['manifest','appcache'],css:'css',csv:'csv',html:['html','htm','shtml','stm'],mathml:'mml',plain:['txt','text','brf','conf','def','list','log','in','bas'],richtext:'rtx','tab-separated-values':'tsv','x-bibtex':'bib'},video:{mpeg:['mpeg','mpg','mpe','m1v','m2v','mp2','mpa','mpv2'],mp4:['mp4','mp4v','mpg4'],quicktime:['qt','mov'],ogg:'ogv','vnd.mpegurl':['mxu','m4u'],'x-flv':'flv','x-la-asf':['lsf','lsx'],'x-mng':'mng','x-ms-asf':['asf','asx','asr'],'x-ms-wm':'wm','x-ms-wmv':'wmv','x-ms-wmx':'wmx','x-ms-wvx':'wvx','x-msvideo':'avi','x-sgi-movie':'movie','x-matroska':['mpv','mkv','mk3d','mks'],'3gpp2':'3g2',h261:'h261',h263:'h263',h264:'h264',jpeg:'jpgv',jpm:['jpm','jpgm'],mj2:['mj2','mjp2'],'vnd.ms-playready.media.pyv':'pyv','vnd.uvvu.mp4':['uvu','uvvu'],'vnd.vivo':'viv',webm:'webm','x-f4v':'f4v','x-m4v':'m4v','x-ms-vob':'vob','x-smv':'smv'}},_=function(){var S,P,L,T,E={};for(S in k)if(k.hasOwnProperty(S))for(P in k[S])if(k[S].hasOwnProperty(P))if(L=k[S][P],'string'==typeof L)E[L]=S+'/'+P;else for(T=0;T<L.length;T++)E[L[T]]=S+'/'+P;return E}();u.exports={lookup:function(S){return S&&_[S.split('.').pop().toLowerCase()]||'text/plain'}}},function(u){u.exports=t},function(u,p,f){'use strict';function v(se){return se&&se.__esModule?se:{default:se}}function k(se,re){if(!(se instanceof re))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(se){return typeof se}:function(se){return se&&'function'==typeof Symbol&&se.constructor===Symbol&&se!==Symbol.prototype?'symbol':typeof se},C=function(){function se(re,oe){for(var de,le=0;le<oe.length;le++)de=oe[le],de.enumerable=de.enumerable||!1,de.configurable=!0,'value'in de&&(de.writable=!0),Object.defineProperty(re,de.key,de)}return function(re,oe,le){return oe&&se(re.prototype,oe),le&&se(re,le),re}}(),S=f(2),P=v(S),L=f(0),T=f(5),E=v(T),z=f(3),R=v(z),N=f(32),B=v(N),O=f(24),A=v(O),M=f(21),W=v(M),I=f(28),U=v(I),F=f(27),D=v(F),H=f(30),V=v(H),X=f(29),Y=v(X),J=f(13),Z=v(J),Q=f(20),K=v(Q),G=f(11),$=v(G),ee=f(1),te=v(ee),ne='META-INF/container.xml',ie=function(){function se(re,oe){var le=this;k(this,se),'undefined'==typeof oe&&'object'===('undefined'==typeof re?'undefined':_(re))&&(oe=re,re=void 0),this.settings=(0,L.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0}),(0,L.extend)(this.settings,oe),this.opening=new L.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new L.defer,spine:new L.defer,metadata:new L.defer,cover:new L.defer,navigation:new L.defer,pageList:new L.defer,resources:new L.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources]),this.isRendered=!1,this.request=this.settings.requestMethod||$.default,this.spine=new B.default,this.locations=new A.default(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=new Y.default,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,this.toc=void 0,re&&this.open(re).catch(function(){var ue=new Error('Cannot load book at '+re);le.emit('openFailed',ue)})}return C(se,[{key:'open',value:function(oe,le){var de,ue=le||this.determineType(oe);return'binary'===ue?(this.archived=!0,this.url=new E.default('/',''),de=this.openEpub(oe)):'base64'===ue?(this.archived=!0,this.url=new E.default('/',''),de=this.openEpub(oe,ue)):'epub'===ue?(this.archived=!0,this.url=new E.default('/',''),de=this.request(oe,'binary').then(this.openEpub.bind(this))):'opf'==ue?(this.url=new E.default(oe),de=this.openPackaging(this.url.Path.toString())):'json'==ue?(this.url=new E.default(oe),de=this.openManifest(this.url.Path.toString())):(this.url=new E.default(oe),de=this.openContainer(ne).then(this.openPackaging.bind(this))),de}},{key:'openEpub',value:function(oe,le){var de=this;return this.unarchive(oe,le||this.settings.encoding).then(function(){return de.openContainer(ne)}).then(function(ue){return de.openPackaging(ue)})}},{key:'openContainer',value:function(oe){var le=this;return this.load(oe).then(function(de){return le.container=new W.default(de),le.resolve(le.container.packagePath)})}},{key:'openPackaging',value:function(oe){var le=this;return this.path=new R.default(oe),this.load(oe).then(function(de){return le.packaging=new U.default(de),le.unpack(le.packaging)})}},{key:'openManifest',value:function(oe){var le=this;return this.path=new R.default(oe),this.load(oe).then(function(de){return le.packaging=new U.default,le.packaging.load(de),le.unpack(le.packaging)})}},{key:'load',value:function(oe){var le;return this.archived?(le=this.resolve(oe),this.archive.request(le)):(le=this.resolve(oe),this.request(le,null,this.settings.requestCredentials,this.settings.requestHeaders))}},{key:'resolve',value:function(oe,le){if(oe){var de=oe,ue=-1<oe.indexOf('://');return ue?oe:(this.path&&(de=this.path.resolve(oe)),!1!=le&&this.url&&(de=this.url.resolve(de)),de)}}},{key:'determineType',value:function(oe){var le,de,ue;return'base64'===this.settings.encoding?'base64':'string'==typeof oe?(le=new E.default(oe),de=le.path(),ue=de.extension,ue?'epub'===ue?'epub':'opf'===ue?'opf':'json'===ue?'json':void 0:'directory'):'binary'}},{key:'unpack',value:function(oe){var le=this;this.package=oe,this.spine.unpack(this.package,this.resolve.bind(this)),this.resources=new V.default(this.package.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||'base64'}),this.loadNavigation(this.package).then(function(){le.toc=le.navigation.toc,le.loading.navigation.resolve(le.navigation)}),this.package.coverPath&&(this.cover=this.resolve(this.package.coverPath)),this.loading.manifest.resolve(this.package.manifest),this.loading.metadata.resolve(this.package.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&'none'!=this.settings.replacements?this.replacements().then(function(){le.opening.resolve(le)}).catch(function(de){console.error(de)}):this.opening.resolve(this)}},{key:'loadNavigation',value:function(oe){var le=this,de=oe.navPath||oe.ncxPath,ue=oe.toc;return ue?new Promise(function(ce){le.navigation=new D.default(ue),le.pageList=new Y.default,ce(le.navigation)}):de?this.load(de,'xml').then(function(ce){return le.navigation=new D.default(ce),le.pageList=new Y.default(ce),le.navigation}):new Promise(function(ce){le.navigation=new D.default,le.pageList=new Y.default,ce(le.navigation)})}},{key:'section',value:function(oe){return this.spine.get(oe)}},{key:'renderTo',value:function(oe,le){return this.rendition=new Z.default(this,le),this.rendition.attachTo(oe),this.rendition}},{key:'setRequestCredentials',value:function(oe){this.settings.requestCredentials=oe}},{key:'setRequestHeaders',value:function(oe){this.settings.requestHeaders=oe}},{key:'unarchive',value:function(oe,le){return this.archive=new K.default,this.archive.open(oe,le)}},{key:'coverUrl',value:function(){var oe=this,le=this.loaded.cover.then(function(){return oe.archived?oe.resources.get(oe.cover):oe.cover});return le}},{key:'replacements',value:function(){var oe=this;return this.spine.hooks.serialize.register(function(le,de){de.output=oe.resources.substitute(le,de.url)}),this.resources.replacements().then(function(){return oe.resources.replaceCss()})}},{key:'range',value:function(oe){var le=new te.default(oe),de=this.spine.get(le.spinePos);return de.load().then(function(){var ce=le.toRange(de.document);return ce})}},{key:'key',value:function(oe){var le=oe||this.package.metadata.identifier||this.url.filename;return'epubjs:'+'0.3'+':'+le}},{key:'destroy',value:function(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.toc=void 0}}]),se}();(0,P.default)(ie.prototype),p.default=ie,u.exports=p['default']},function(u,p,f){'use strict';function k(z,R){if(!(z instanceof R))throw new TypeError('Cannot call a class as a function')}function _(z,R){if(!z)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return R&&('object'==typeof R||'function'==typeof R)?R:z}function C(z,R){if('function'!=typeof R&&null!==R)throw new TypeError('Super expression must either be null or a function, not '+typeof R);z.prototype=Object.create(R&&R.prototype,{constructor:{value:z,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(z,R):z.__proto__=R)}Object.defineProperty(p,'__esModule',{value:!0});var S=function(){function z(R,N){for(var O,B=0;B<N.length;B++)O=N[B],O.enumerable=O.enumerable||!1,O.configurable=!0,'value'in O&&(O.writable=!0),Object.defineProperty(R,O.key,O)}return function(R,N,B){return N&&z(R.prototype,N),B&&z(R,B),R}}(),P=f(0),L=f(12),T=function(z){return z&&z.__esModule?z:{default:z}}(L),E=function(z){function R(N){k(this,R);var B=_(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,N));return B.name='continuous',B.settings=(0,P.extend)(B.settings||{},{infinite:!0,overflow:'auto',axis:'vertical',offset:500,offsetDelta:250,width:void 0,height:void 0}),(0,P.extend)(B.settings,N.settings||{}),'undefined'!=N.settings.gap&&0===N.settings.gap&&(B.settings.gap=N.settings.gap),B.viewSettings={ignoreClass:B.settings.ignoreClass,axis:B.settings.axis,layout:B.layout,width:0,height:0},B.scrollTop=0,B.scrollLeft=0,B}return C(R,z),S(R,[{key:'display',value:function(B,O){return T.default.prototype.display.call(this,B,O).then(function(){return this.fill()}.bind(this))}},{key:'fill',value:function(B){var O=B||new P.defer;return this.check().then(function(A){A?this.fill(O):O.resolve()}.bind(this)),O.promise}},{key:'moveTo',value:function(B){var O=0,A=0,M=0,W=0;return'vertical'===this.settings.axis?(A=B.top,W=B.top+this.settings.offset):(O=Math.floor(B.left/this.layout.delta)*this.layout.delta,M=O+this.settings.offset),this.check(M,W).then(function(){this.scrollBy(O,A,!0)}.bind(this))}},{key:'resize',value:function(B,O){this.q.clear(),this._stageSize=this.stage.size(B,O),this._bounds=this.bounds(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.views.each(function(A){A.size(this._stageSize.width,this._stageSize.height)}.bind(this)),this.updateLayout(),this.emit('resized',{width:this.stage.width,height:this.stage.height})}},{key:'onResized',value:function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.resize()}.bind(this),150)}},{key:'afterResized',value:function(B){this.emit('resize',B.section)}},{key:'removeShownListeners',value:function(B){B.onDisplayed=function(){}}},{key:'append',value:function(B){var O=this.createView(B);return this.views.append(O),O.onDisplayed=this.afterDisplayed.bind(this),O}},{key:'prepend',value:function(B){var O=this.createView(B);return O.on('resized',this.counter.bind(this)),this.views.prepend(O),O.onDisplayed=this.afterDisplayed.bind(this),O}},{key:'counter',value:function(B){'vertical'===this.settings.axis?this.scrollBy(0,B.heightDelta,!0):this.scrollBy(B.widthDelta,0,!0)}},{key:'update',value:function(B){for(var U,F,O=this.bounds(),A=this.views.all(),M=A.length,W=[],I='undefined'==typeof B?this.settings.offset||0:B,D=new P.defer,H=[],V=0;V<M;V++)F=A[V],U=this.isVisible(F,I,I,O),!0===U?(!F.displayed&&H.push(F.display(this.request).then(function(X){X.show()})),W.push(F)):(this.q.enqueue(F.destroy.bind(F)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250));return H.length?Promise.all(H):(D.resolve(),D.promise)}},{key:'check',value:function(B,O){var A,M,W,I,U=new P.defer,F=[],D='horizontal'===this.settings.axis,H=this.settings.offset||0;B&&D&&(H=B),O&&!D&&(H=O);var V=this._bounds,X=D?this.scrollLeft:this.scrollTop,Y=D?V.width:V.height,J=D?this.container.scrollWidth:this.container.scrollHeight;return X+Y+H>=J&&(A=this.views.last(),W=A&&A.section.next(),W&&F.push(this.append(W))),0>X-H&&(M=this.views.first(),I=M&&M.section.prev(),I&&F.push(this.prepend(I))),F.length?this.q.enqueue(function(){return this.update(H)}.bind(this)):(U.resolve(!1),U.promise)}},{key:'trim',value:function(){for(var B=new P.defer,O=this.views.displayed(),A=O[0],M=O[O.length-1],W=this.views.indexOf(A),I=this.views.indexOf(M),U=this.views.slice(0,W),F=this.views.slice(I+1),D=0;D<U.length-1;D++)this.erase(U[D],U);for(var H=1;H<F.length;H++)this.erase(F[H]);return B.resolve(),B.promise}},{key:'erase',value:function(B,O){var A,M;this.settings.height?(A=this.container.scrollTop,M=this.container.scrollLeft):(A=window.scrollY,M=window.scrollX);var W=B.bounds();this.views.remove(B),O&&('vertical'===this.settings.axis?this.scrollTo(0,A-W.height,!0):this.scrollTo(M-W.width,0,!0))}},{key:'addEventListeners',value:function(){window.addEventListener('unload',function(){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners()}},{key:'addScrollListeners',value:function(){var B;this.tick=P.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.height?(B=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft):(B=window,this.scrollTop=window.scrollY,this.scrollLeft=window.scrollX),B.addEventListener('scroll',this.onScroll.bind(this)),this.scrolled=!1}},{key:'removeEventListeners',value:function(){var B;B=this.settings.height?this.container:window,B.removeEventListener('scroll',this.onScroll.bind(this))}},{key:'onScroll',value:function(){var B,O;this.settings.height?(B=this.container.scrollTop,O=this.container.scrollLeft):(B=window.scrollY,O=window.scrollX),this.scrollTop=B,this.scrollLeft=O,this.ignore?this.ignore=!1:(0===this.scrollDeltaVert&&0===this.scrollDeltaHorz||this.scrollDeltaVert>this.settings.offsetDelta||this.scrollDeltaHorz>this.settings.offsetDelta)&&(this.q.enqueue(function(){this.check()}.bind(this)),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.emit('scroll',{top:B,left:O}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit('scrolled',{top:this.scrollTop,left:this.scrollLeft})}.bind(this))),this.scrollDeltaVert+=Math.abs(B-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(O-this.prevScrollLeft),this.prevScrollTop=B,this.prevScrollLeft=O,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.scrolled=!1}},{key:'updateLayout',value:function(){this.stage&&('vertical'===this.settings.axis?this.layout.calculate(this._stageSize.width,this._stageSize.height):(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta,this.stage.addStyleRules('iframe',[{'margin-right':this.layout.gap+'px'}])),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}},{key:'next',value:function(){'horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,this.container.scrollLeft+this.container.offsetWidth+this.layout.delta<this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this))}},{key:'prev',value:function(){'horizontal'===this.settings.axis?this.scrollBy(-this.layout.delta,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this))}},{key:'updateFlow',value:function(B){var O='paginated'===B?'horizontal':'vertical';this.settings.axis=O,this.viewSettings.axis=O,this.settings.overflow='paginated'===B?'hidden':'auto',this.settings.infinite='vertical'===this.settings.axis}}]),R}(T.default);p.default=E,u.exports=p['default']},function(u,p,f){'use strict';function v(N){return N&&N.__esModule?N:{default:N}}function k(N,B){if(!(N instanceof B))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function N(B,O){for(var M,A=0;A<O.length;A++)M=O[A],M.enumerable=M.enumerable||!1,M.configurable=!0,'value'in M&&(M.writable=!0),Object.defineProperty(B,M.key,M)}return function(B,O,A){return O&&N(B.prototype,O),A&&N(B,A),B}}(),C=f(2),S=v(C),P=f(0),L=f(1),T=v(L),E=f(7),z=v(E),R=function(){function N(B,O){k(this,N),this.settings=(0,P.extend)({ignoreClass:'',axis:'vertical',width:0,height:0,layout:void 0,globalLayoutProperties:{}},O||{}),this.id='epubjs-view-'+(0,P.uuid)(),this.section=B,this.index=B.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.width=this.settings.width,this.height=this.settings.height,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new T.default,this.layout=this.settings.layout}return _(N,[{key:'container',value:function(O){var A=document.createElement('div');return A.classList.add('epub-view'),A.style.height='0px',A.style.width='0px',A.style.overflow='hidden',A.style.display=O&&'horizontal'==O?'inline-block':'block',A}},{key:'create',value:function(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement('iframe'),this.iframe.id=this.id,this.iframe.scrolling='no',this.iframe.style.overflow='hidden',this.iframe.seamless='seamless',this.iframe.style.border='none',this.resizing=!0,this.element.style.visibility='hidden',this.iframe.style.visibility='hidden',this.iframe.style.width='0',this.iframe.style.height='0',this._width=0,this._height=0,this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=(0,P.bounds)(this.element),this.supportsSrcdoc=!!('srcdoc'in this.iframe),this.iframe)}},{key:'render',value:function(O,A){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(O)),this.sectionRender.then(function(M){return this.load(M)}.bind(this)).then(function(){}.bind(this)).then(function(){this.settings.layout.format(this.contents),this.expand(),this.addListeners(),!1!==A,this.emit('rendered',this.section)}.bind(this)).catch(function(M){this.emit('loaderror',M)}.bind(this))}},{key:'size',value:function(O,A){var M=O||this.settings.width,W=A||this.settings.height;'pre-paginated'===this.layout.name?this.lock('both',M,W):'horizontal'===this.settings.axis?this.lock('height',M,W):this.lock('width',M,W)}},{key:'lock',value:function(O,A,M){var I,W=(0,P.borders)(this.element);I=this.iframe?(0,P.borders)(this.iframe):{width:0,height:0},'width'==O&&(0,P.isNumber)(A)&&(this.lockedWidth=A-W.width-I.width,this.resize(this.lockedWidth,A)),'height'==O&&(0,P.isNumber)(M)&&(this.lockedHeight=M-W.height-I.height,this.resize(A,this.lockedHeight)),'both'===O&&(0,P.isNumber)(A)&&(0,P.isNumber)(M)&&(this.lockedWidth=A-W.width-I.width,this.lockedHeight=M-W.height-I.height,this.resize(this.lockedWidth,this.lockedHeight)),this.displayed&&this.iframe&&this.expand()}},{key:'expand',value:function(){var W,I,U,A=this.lockedWidth,M=this.lockedHeight;!this.iframe||this._expanding||'pre-paginated'===this.layout.name||(this._expanding=!0,'horizontal'===this.settings.axis?(I=this.contents.textWidth(),A=this.contentWidth(I),A==this._width?A=this._contentWidth:(W=Math.ceil(A/(this.settings.layout.columnWidth+this.settings.layout.gap)),1<this.settings.layout.divisor&&'reflowable'===this.settings.layout.name&&0<W%2&&(A+=this.settings.layout.gap+this.settings.layout.columnWidth),this._textWidth=I,this._contentWidth=A)):'vertical'===this.settings.axis&&(U=this.contents.textHeight(),U==this._textHeight?M=this._contentHeight:(M=this.contentHeight(U),this._textHeight=U,this._contentHeight=M)),(this._needsReframe||A!=this._width||M!=this._height)&&this.resize(A,M),this._expanding=!1)}},{key:'contentWidth',value:function(O){var A,M;return A=this.iframe.style.width,this.iframe.style.width=(O||0)+'px',M=this.contents.scrollWidth(),this.iframe.style.width=A,M}},{key:'contentHeight',value:function(O){var A,M;return A=this.iframe.style.height,this.iframe.style.height=(O||0)+'px',M=this.contents.scrollHeight(),this.iframe.style.height=A,M}},{key:'resize',value:function(O,A){this.iframe&&((0,P.isNumber)(O)&&(this.iframe.style.width=O+'px',this._width=O),(0,P.isNumber)(A)&&(this.iframe.style.height=A+'px',this._height=A),this.iframeBounds=(0,P.bounds)(this.iframe),this.reframe(this.iframeBounds.width,this.iframeBounds.height))}},{key:'reframe',value:function(O,A){var M;(0,P.isNumber)(O)&&(this.element.style.width=O+'px'),(0,P.isNumber)(A)&&(this.element.style.height=A+'px'),this.prevBounds=this.elementBounds,this.elementBounds=(0,P.bounds)(this.element),M={width:this.elementBounds.width,height:this.elementBounds.height,widthDelta:this.elementBounds.width-this.prevBounds.width,heightDelta:this.elementBounds.height-this.prevBounds.height},this.onResize(this,M),this.contents&&this.settings.layout.format(this.contents),this.emit('resized',M)}},{key:'load',value:function(O){var A=new P.defer,M=A.promise;if(!this.iframe)return A.reject(new Error('No Iframe Available')),M;if(this.iframe.onload=function(W){this.onLoad(W,A)}.bind(this),this.supportsSrcdoc)this.iframe.srcdoc=O;else{if(this.document=this.iframe.contentDocument,!this.document)return A.reject(new Error('No Document Available')),M;this.iframe.contentDocument.open(),this.iframe.contentDocument.write(O),this.iframe.contentDocument.close()}return M}},{key:'onLoad',value:function(O,A){this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new z.default(this.document,this.document.body,this.section.cfiBase,this.settings.pageStyle),this.rendering=!1;var M=this.document.querySelector('link[rel=\'canonical\']');M?M.setAttribute('href',this.section.url):(M=this.document.createElement('link'),M.setAttribute('rel','canonical'),M.setAttribute('href',this.section.url),this.document.querySelector('head').appendChild(M)),this.contents.on('expand',function(){this.displayed&&this.iframe&&this.expand()}),A.resolve(this.contents)}},{key:'setLayout',value:function(O){this.layout=O}},{key:'setAxis',value:function(O){this.settings.axis=O}},{key:'resizeListenters',value:function(){clearTimeout(this.expanding),this.expanding=setTimeout(this.expand.bind(this),350)}},{key:'addListeners',value:function(){}},{key:'removeListeners',value:function(){}},{key:'display',value:function(O){var A=new P.defer;return this.displayed?A.resolve(this):this.render(O).then(function(){this.emit('displayed',this),this.onDisplayed(this),this.displayed=!0,A.resolve(this)}.bind(this)),A.promise}},{key:'show',value:function(){this.element.style.visibility='visible',this.iframe&&(this.iframe.style.visibility='visible'),this.emit('shown',this)}},{key:'hide',value:function(){this.element.style.visibility='hidden',this.iframe.style.visibility='hidden',this.stopExpanding=!0,this.emit('hidden',this)}},{key:'position',value:function(){return this.element.getBoundingClientRect()}},{key:'locationOf',value:function(O){var A=this.iframe.getBoundingClientRect(),M=this.contents.locationOf(O,this.settings.ignoreClass);return{left:window.scrollX+A.left+M.left,top:window.scrollY+A.top+M.top}}},{key:'onDisplayed',value:function(){}},{key:'onResize',value:function(){}},{key:'bounds',value:function(){return this.elementBounds||(this.elementBounds=(0,P.bounds)(this.element)),this.elementBounds}},{key:'destroy',value:function(){this.displayed&&(this.displayed=!1,this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.displayed=!1,this.iframe=null,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}]),N}();(0,S.default)(R.prototype),p.default=R,u.exports=p['default']},function(u){var f=function(){return this}();try{f=f||Function('return this')()||(1,eval)('this')}catch(v){'object'==typeof window&&(f=window)}u.exports=f},function(u,p,f){'use strict';function v(N){return N&&N.__esModule?N:{default:N}}function k(N,B){if(!(N instanceof B))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function N(B,O){for(var M,A=0;A<O.length;A++)M=O[A],M.enumerable=M.enumerable||!1,M.configurable=!0,'value'in M&&(M.writable=!0),Object.defineProperty(B,M.key,M)}return function(B,O,A){return O&&N(B.prototype,O),A&&N(B,A),B}}(),C=f(0),S=f(11),P=v(S),L=f(14),T=v(L),E=f(3),z=v(E),R=function(){function N(){k(this,N),this.zip=void 0,this.urlCache={},this.checkRequirements()}return _(N,[{key:'checkRequirements',value:function(){try{if('undefined'==typeof JSZip){var O=f(49);this.zip=new O}else this.zip=new JSZip}catch(A){throw new Error('JSZip lib not loaded')}}},{key:'open',value:function(O,A){return this.zip.loadAsync(O,{base64:A})}},{key:'openUrl',value:function(O,A){return(0,P.default)(O,'binary').then(function(M){return this.zip.loadAsync(M,{base64:A})}.bind(this))}},{key:'request',value:function(O,A){var W,M=new C.defer,I=new z.default(O);return A||(A=I.extension),W='blob'==A?this.getBlob(O):this.getText(O),W?W.then(function(U){var F=this.handleResponse(U,A);M.resolve(F)}.bind(this)):M.reject({message:'File not found in the epub: '+O,stack:new Error().stack}),M.promise}},{key:'handleResponse',value:function(O,A){var M;return M='json'==A?JSON.parse(O):(0,C.isXml)(A)?(0,C.parse)(O,'text/xml'):'xhtml'==A?(0,C.parse)(O,'application/xhtml+xml'):'html'==A||'htm'==A?(0,C.parse)(O,'text/html'):O,M}},{key:'getBlob',value:function(O,A){var M=window.decodeURIComponent(O.substr(1)),W=this.zip.file(M);if(W)return A=A||T.default.lookup(W.name),W.async('uint8array').then(function(I){return new Blob([I],{type:A})})}},{key:'getText',value:function(O){var M=window.decodeURIComponent(O.substr(1)),W=this.zip.file(M);if(W)return W.async('string').then(function(I){return I})}},{key:'getBase64',value:function(O,A){var M=window.decodeURIComponent(O.substr(1)),W=this.zip.file(M);if(W)return A=A||T.default.lookup(W.name),W.async('base64').then(function(I){return'data:'+A+';base64,'+I})}},{key:'createUrl',value:function(O,A){var I,U,M=new C.defer,W=window.URL||window.webkitURL||window.mozURL,F=A&&A.base64;return O in this.urlCache?(M.resolve(this.urlCache[O]),M.promise):(F?(U=this.getBase64(O),U&&U.then(function(D){this.urlCache[O]=D,M.resolve(D)}.bind(this))):(U=this.getBlob(O),U&&U.then(function(D){I=W.createObjectURL(D),this.urlCache[O]=I,M.resolve(I)}.bind(this))),U||M.reject({message:'File not found in the epub: '+O,stack:new Error().stack}),M.promise)}},{key:'revokeUrl',value:function(O){var A=window.URL||window.webkitURL||window.mozURL,M=this.urlCache[O];M&&A.revokeObjectURL(M)}},{key:'destroy',value:function(){var O=window.URL||window.webkitURL||window.mozURL;for(var A in this.urlCache)O.revokeObjectURL(A);this.zip=void 0,this.urlCache={}}}]),N}();p.default=R,u.exports=p['default']},function(u,p,f){'use strict';function k(T,E){if(!(T instanceof E))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function T(E,z){for(var N,R=0;R<z.length;R++)N=z[R],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(E,N.key,N)}return function(E,z,R){return z&&T(E.prototype,z),R&&T(E,R),E}}(),C=f(6),S=function(T){return T&&T.__esModule?T:{default:T}}(C),P=f(0),L=function(){function T(E){k(this,T),this.packagePath='',this.directory='',this.encoding='',E&&this.parse(E)}return _(T,[{key:'parse',value:function(z){var R;if(!z)throw new Error('Container File Not Found');if(R=(0,P.qs)(z,'rootfile'),!R)throw new Error('No RootFile Found');this.packagePath=R.getAttribute('full-path'),this.directory=S.default.dirname(this.packagePath),this.encoding=z.xmlEncoding}},{key:'destroy',value:function(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}]),T}();p.default=L,u.exports=p['default']},function(u,p,f){'use strict';(function(v){function k(N){return N&&N.__esModule?N:{default:N}}function _(N,B){return new S.default(N,B)}Object.defineProperty(p,'__esModule',{value:!0});var C=f(16),S=k(C),P=f(1),L=k(P),T=f(13),E=k(T),z=f(7),R=k(z);_.VERSION='0.3','undefined'!=typeof v&&(v.EPUBJS_VERSION=_.VERSION),_.CFI=L.default,_.Rendition=E.default,_.Contents=R.default,_.ViewManagers={},_.Views={},_.register={manager:function(B,O){return _.ViewManagers[B]=O},view:function(B,O){return _.Views[B]=O}},_.register.view('iframe',f(18)),_.register.manager('default',f(12)),_.register.manager('continuous',f(17)),p.default=_,u.exports=p['default']}).call(p,f(19))},function(u,p){'use strict';function v(C,S){if(!(C instanceof S))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var k=function(){function C(S,P){for(var T,L=0;L<P.length;L++)T=P[L],T.enumerable=T.enumerable||!1,T.configurable=!0,'value'in T&&(T.writable=!0),Object.defineProperty(S,T.key,T)}return function(S,P,L){return P&&C(S.prototype,P),L&&C(S,L),S}}(),_=function(){function C(S){v(this,C),this.settings=S,this.name=S.layout||'reflowable',this._spread='none'!==S.spread,this._minSpreadWidth=S.minSpreadWidth||800,this._evenSpreads=S.evenSpreads||!1,this._flow='scrolled-continuous'===S.flow||'scrolled-doc'===S.flow?'scrolled':'paginated',this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}return k(C,[{key:'flow',value:function(P){return'undefined'!=typeof P&&(this._flow='scrolled-continuous'===P||'scrolled-doc'===P?'scrolled':'paginated',this.props.flow=this._flow),this._flow}},{key:'spread',value:function(P,L){return P&&(this._spread='none'!==P,this.props.spread=this._spread),0<=L&&(this._minSpreadWidth=L),this._spread}},{key:'calculate',value:function(P,L,T){var B,O,A,E=1,z=T||0,R=P,N=Math.floor(R/8);E=this._spread&&R>=this._minSpreadWidth?2:1,'reflowable'!==this.name||'paginated'!==this._flow||0<=T||(z=0==N%2?N:N-1),'pre-paginated'===this.name&&(z=0),B=1<E?(R-z)/E:R,'pre-paginated'===this.name&&1<E&&(R=B),O=B*E,A=(B+z)*E,this.width=R,this.height=L,this.spreadWidth=O,this.delta=A,this.columnWidth=B,this.gap=z,this.divisor=E,this.props.width=R,this.props.height=L,this.props.spreadWidth=O,this.props.delta=A,this.props.columnWidth=B,this.props.gap=z,this.props.divisor=E}},{key:'format',value:function(P){var L;return L='pre-paginated'===this.name?P.fit(this.columnWidth,this.height):'paginated'===this._flow?P.columns(this.width,this.height-5,this.columnWidth,this.gap):P.size(this.width,null),L}},{key:'count',value:function(P){var L=Math.ceil(P/this.spreadWidth);return{spreads:L,pages:L*this.divisor}}}]),C}();p.default=_,u.exports=p['default']},function(u,p,f){'use strict';function v(N){return N&&N.__esModule?N:{default:N}}function k(N,B){if(!(N instanceof B))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function N(B,O){for(var M,A=0;A<O.length;A++)M=O[A],M.enumerable=M.enumerable||!1,M.configurable=!0,'value'in M&&(M.writable=!0),Object.defineProperty(B,M.key,M)}return function(B,O,A){return O&&N(B.prototype,O),A&&N(B,A),B}}(),C=f(0),S=f(10),P=v(S),L=f(1),T=v(L),E=f(2),z=v(E),R=function(){function N(B,O,A){k(this,N),this.spine=B,this.request=O,this.pause=A||100,this.q=new P.default(this),this.epubcfi=new T.default,this._locations=[],this.total=0,this.break=150,this._current=0,this.currentLocation='',this._currentCfi='',this.processingTimeout=void 0}return _(N,[{key:'generate',value:function(O){return O&&(this.break=O),this.q.pause(),this.spine.each(function(A){this.q.enqueue(this.process.bind(this),A)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}},{key:'createRange',value:function(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}},{key:'process',value:function(O){return O.load(this.request).then(function(A){var M=new C.defer,W=this.parse(A,O.cfiBase);return this._locations=this._locations.concat(W),O.unload(),this.processingTimeout=setTimeout(function(){return M.resolve(W)},this.pause),M.promise}.bind(this))}},{key:'parse',value:function(O,A,M){var I,H,W=[],U=O.ownerDocument,F=(0,C.qs)(U,'body'),D=0,V=M||this.break;if((0,C.sprint)(F,function(Z){var K,Q=Z.length,G=0;if(0===Z.textContent.trim().length)return!1;for(0==D&&(I=this.createRange(),I.startContainer=Z,I.startOffset=0),K=V-D,K>Q&&(D+=Q,G=Q);G<Q;)if(G+=K,G>=Q)D=Q-(G-V);else{I.endContainer=Z,I.endOffset=G;var $=new T.default(I,A).toString();W.push($),D=0,G+=1,I=this.createRange(),I.startContainer=Z,I.startOffset=G,K=V}H=Z}.bind(this)),I&&I.startContainer&&H){I.endContainer=H,I.endOffset=H.length;var Y=new T.default(I,A).toString();W.push(Y),D=0}return W}},{key:'locationFromCfi',value:function(O){return 0===this._locations.length?-1:(0,C.locationOf)(O.start,this._locations,this.epubcfi.compare)}},{key:'percentageFromCfi',value:function(O){if(0===this._locations.length)return null;var A=this.locationFromCfi(O);return this.percentageFromLocation(A)}},{key:'percentageFromLocation',value:function(O){return O&&this.total?O/this.total:0}},{key:'cfiFromLocation',value:function(O){var A=-1;return'number'!=typeof O&&(O=parseInt(O)),0<=O&&O<this._locations.length&&(A=this._locations[O]),A}},{key:'cfiFromPercentage',value:function(O){var A=1<O?O/100:O,M=Math.ceil(this.total*A);return this.cfiFromLocation(M)}},{key:'load',value:function(O){return this._locations=JSON.parse(O),this.total=this._locations.length-1,this._locations}},{key:'save',value:function(){return JSON.stringify(this._locations)}},{key:'getCurrent',value:function(){return this._current}},{key:'setCurrent',value:function(O){var A;if('string'==typeof O)this._currentCfi=O;else if('number'==typeof O)this._current=O;else return;0===this._locations.length||('string'==typeof O?(A=this.locationFromCfi(O),this._current=A):A=O,this.emit('changed',{percentage:this.percentageFromLocation(A)}))}},{key:'length',value:function(){return this._locations.length}},{key:'destroy',value:function(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.clear(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}},{key:'currentLocation',get:function(){return this._current},set:function(O){this.setCurrent(O)}}]),N}();(0,z.default)(R.prototype),p.default=R,u.exports=p['default']},function(u,p,f){'use strict';function v(S,P){if(!(S instanceof P))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var k=function(){function S(P,L){for(var E,T=0;T<L.length;T++)E=L[T],E.enumerable=E.enumerable||!1,E.configurable=!0,'value'in E&&(E.writable=!0),Object.defineProperty(P,E.key,E)}return function(P,L,T){return L&&S(P.prototype,L),T&&S(P,T),P}}(),_=f(0),C=function(){function S(P){v(this,S),this.settings=P||{},this.id='epubjs-container-'+(0,_.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}return k(S,[{key:'create',value:function(L){var T=L.height,E=L.width,z=L.overflow||!1,R=L.axis||'vertical';L.height&&(0,_.isNumber)(L.height)&&(T=L.height+'px'),L.width&&(0,_.isNumber)(L.width)&&(E=L.width+'px');var N=document.createElement('div');return N.id=this.id,N.classList.add('epub-container'),N.style.wordSpacing='0',N.style.lineHeight='0',N.style.verticalAlign='top','horizontal'===R&&(N.style.whiteSpace='nowrap'),E&&(N.style.width=E),T&&(N.style.height=T),z&&(N.style.overflow=z),N}},{key:'wrap',value:function(L){var T=document.createElement('div');return T.style.visibility='hidden',T.style.overflow='hidden',T.style.width='0',T.style.height='0',T.appendChild(L),T}},{key:'getElement',value:function(L){var T;if((0,_.isElement)(L)?T=L:'string'==typeof L&&(T=document.getElementById(L)),!T)throw new Error('Not an Element');return T}},{key:'attachTo',value:function(L){var E,T=this.getElement(L);if(T)return E=this.settings.hidden?this.wrapper:this.container,T.appendChild(E),this.element=T,T}},{key:'getContainer',value:function(){return this.container}},{key:'onResize',value:function(L){(0,_.isNumber)(this.settings.width)&&(0,_.isNumber)(this.settings.height)||window.addEventListener('resize',L,!1)}},{key:'size',value:function(L,T){var E;return null===L&&(E=this.element.getBoundingClientRect(),E.width&&(L=E.width,this.container.style.width=E.width+'px')),null===T&&(E=E||this.element.getBoundingClientRect(),E.height&&(T=E.height,this.container.style.height=E.height+'px')),(0,_.isNumber)(L)||(E=this.container.getBoundingClientRect(),L=E.width),(0,_.isNumber)(T)||(E=E||this.container.getBoundingClientRect(),T=E.height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles['padding-left'])||0,right:parseFloat(this.containerStyles['padding-right'])||0,top:parseFloat(this.containerStyles['padding-top'])||0,bottom:parseFloat(this.containerStyles['padding-bottom'])||0},{width:L-this.containerPadding.left-this.containerPadding.right,height:T-this.containerPadding.top-this.containerPadding.bottom}}},{key:'bounds',value:function(){return this.container?this.container.getBoundingClientRect():(0,_.windowBounds)()}},{key:'getSheet',value:function(){var L=document.createElement('style');return L.appendChild(document.createTextNode('')),document.head.appendChild(L),L.sheet}},{key:'addStyleRules',value:function(L,T){var E='#'+this.id+' ',z='';this.sheet||(this.sheet=this.getSheet()),T.forEach(function(R){for(var N in R)R.hasOwnProperty(N)&&(z+=N+':'+R[N]+';')}),this.sheet.insertRule(E+L+' {'+z+'}',0)}},{key:'destroy',value:function(){var L;this.element&&(L=this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container))}}]),S}();p.default=C,u.exports=p['default']},function(u,p){'use strict';function v(C,S){if(!(C instanceof S))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var k=function(){function C(S,P){for(var T,L=0;L<P.length;L++)T=P[L],T.enumerable=T.enumerable||!1,T.configurable=!0,'value'in T&&(T.writable=!0),Object.defineProperty(S,T.key,T)}return function(S,P,L){return P&&C(S.prototype,P),L&&C(S,L),S}}(),_=function(){function C(S){v(this,C),this.container=S,this._views=[],this.length=0,this.hidden=!1}return k(C,[{key:'all',value:function(){return this._views}},{key:'first',value:function(){return this._views[0]}},{key:'last',value:function(){return this._views[this._views.length-1]}},{key:'indexOf',value:function(P){return this._views.indexOf(P)}},{key:'slice',value:function(){return this._views.slice.apply(this._views,arguments)}},{key:'get',value:function(P){return this._views[P]}},{key:'append',value:function(P){return this._views.push(P),this.container&&this.container.appendChild(P.element),this.length++,P}},{key:'prepend',value:function(P){return this._views.unshift(P),this.container&&this.container.insertBefore(P.element,this.container.firstChild),this.length++,P}},{key:'insert',value:function(P,L){return this._views.splice(L,0,P),this.container&&(L<this.container.children.length?this.container.insertBefore(P.element,this.container.children[L]):this.container.appendChild(P.element)),this.length++,P}},{key:'remove',value:function(P){var L=this._views.indexOf(P);-1<L&&this._views.splice(L,1),this.destroy(P),this.length--}},{key:'destroy',value:function(P){P.displayed&&P.destroy(),this.container&&this.container.removeChild(P.element),P=null}},{key:'each',value:function(){return this._views.forEach.apply(this._views,arguments)}},{key:'clear',value:function(){var P,L=this.length;if(this.length){for(var T=0;T<L;T++)P=this._views[T],this.destroy(P);this._views=[],this.length=0}}},{key:'find',value:function(P){for(var L,T=this.length,E=0;E<T;E++)if(L=this._views[E],L.displayed&&L.section.index==P.index)return L}},{key:'displayed',value:function(){for(var P,S=[],L=this.length,T=0;T<L;T++)P=this._views[T],P.displayed&&S.push(P);return S}},{key:'show',value:function(){for(var P,L=this.length,T=0;T<L;T++)P=this._views[T],P.displayed&&P.show();this.hidden=!1}},{key:'hide',value:function(){for(var P,L=this.length,T=0;T<L;T++)P=this._views[T],P.displayed&&P.hide();this.hidden=!0}}]),C}();p.default=_,u.exports=p['default']},function(u,p,f){'use strict';function v(S,P){if(!(S instanceof P))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var k=function(){function S(P,L){for(var E,T=0;T<L.length;T++)E=L[T],E.enumerable=E.enumerable||!1,E.configurable=!0,'value'in E&&(E.writable=!0),Object.defineProperty(P,E.key,E)}return function(P,L,T){return L&&S(P.prototype,L),T&&S(P,T),P}}(),_=f(0),C=function(){function S(P){v(this,S),this.toc=[],this.tocByHref={},this.tocById={},P&&this.parse(P)}return k(S,[{key:'parse',value:function(L){var E,z,T=L.nodeType;T&&(E=(0,_.qs)(L,'html'),z=(0,_.qs)(L,'ncx')),T?E?this.toc=this.parseNav(L):z&&(this.toc=this.parseNcx(L)):this.toc=this.load(L),this.unpack(this.toc)}},{key:'unpack',value:function(L){for(var T,E=0;E<L.length;E++)T=L[E],this.tocByHref[T.href]=E,this.tocById[T.id]=E}},{key:'get',value:function(L){var T;return L?(0===L.indexOf('#')?T=this.tocById[L.substring(1)]:L in this.tocByHref&&(T=this.tocByHref[L]),this.toc[T]):this.toc}},{key:'createTocItem',value:function(L,T){var E=this,z=[],R=L.childNodes,N=Array.prototype.slice.call(R),B=T?T:0;return N.forEach(function(O){if('li'===O.nodeName){var A=(0,_.qs)(O,'a'),M={id:-1,href:A.getAttribute('href'),label:A.textContent,parent:null},W=(0,_.qs)(O,'ol');if(B++,M.id=B,T&&(M.parent=T),z.push(M),W){var I=E.createTocItem(W,B);I&&0<I.length&&(B+=I.length,z=z.concat(I))}}}),z}},{key:'parseNav',value:function(L){var T=(0,_.querySelectorByType)(L,'nav','toc'),E=(0,_.qs)(T,'ol');return this.createTocItem(E)}},{key:'navItem',value:function(L){var O,T=L.getAttribute('id')||!1,E=(0,_.qs)(L,'a'),z=E.getAttribute('href')||'',R=E.textContent||'',B=L.parentNode;return B&&'navPoint'===B.nodeName&&(O=B.getAttribute('id')),{id:T,href:z,label:R,subitems:[],parent:O}}},{key:'parseNcx',value:function(L){var z,B,O,T=(0,_.qsa)(L,'navPoint'),E=T.length,R={},N=[];if(!T||0===E)return N;for(z=0;z<E;++z)B=this.ncxItem(T[z]),R[B.id]=B,B.parent?(O=R[B.parent],O.subitems.push(B)):N.push(B);return N}},{key:'ncxItem',value:function(L){var A,T=L.getAttribute('id')||!1,E=(0,_.qs)(L,'content'),z=E.getAttribute('src'),R=(0,_.qs)(L,'navLabel'),N=R.textContent?R.textContent:'',O=L.parentNode;return O&&'navPoint'===O.nodeName&&(A=O.getAttribute('id')),{id:T,href:z,label:N,subitems:[],parent:A}}},{key:'load',value:function(L){var T=this;return L.map(function(E){return E.label=E.title,E.children&&(E.subitems=T.load(E.children)),E})}},{key:'forEach',value:function(L){return this.toc.forEach(L)}}]),S}();p.default=C,u.exports=p['default']},function(u,p,f){'use strict';function v(S,P){if(!(S instanceof P))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var k=function(){function S(P,L){for(var E,T=0;T<L.length;T++)E=L[T],E.enumerable=E.enumerable||!1,E.configurable=!0,'value'in E&&(E.writable=!0),Object.defineProperty(P,E.key,E)}return function(P,L,T){return L&&S(P.prototype,L),T&&S(P,T),P}}(),_=f(0),C=function(){function S(P){v(this,S),this.manifest={},this.navPath='',this.ncxPath='',this.coverPath='',this.spineNodeIndex=0,this.spine=[],this.metadata={},P&&this.parse(P)}return k(S,[{key:'parse',value:function(L){var T,E,z;if(!L)throw new Error('Package File Not Found');if(T=(0,_.qs)(L,'metadata'),!T)throw new Error('No Metadata Found');if(E=(0,_.qs)(L,'manifest'),!E)throw new Error('No Manifest Found');if(z=(0,_.qs)(L,'spine'),!z)throw new Error('No Spine Found');return this.manifest=this.parseManifest(E),this.navPath=this.findNavPath(E),this.ncxPath=this.findNcxPath(E,z),this.coverPath=this.findCoverPath(L),this.spineNodeIndex=(0,_.indexOfElementNode)(z),this.spine=this.parseSpine(z,this.manifest),this.metadata=this.parseMetadata(T),this.metadata.direction=z.getAttribute('page-progression-direction'),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}},{key:'parseMetadata',value:function(L){var T={title:this.getElementText(L,'title'),creator:this.getElementText(L,'creator'),description:this.getElementText(L,'description'),pubdate:this.getElementText(L,'date'),publisher:this.getElementText(L,'publisher'),identifier:this.getElementText(L,'identifier'),language:this.getElementText(L,'language'),rights:this.getElementText(L,'rights'),modified_date:this.getPropertyText(L,'dcterms:modified'),layout:this.getPropertyText(L,'rendition:layout'),orientation:this.getPropertyText(L,'rendition:orientation'),flow:this.getPropertyText(L,'rendition:flow'),viewport:this.getPropertyText(L,'rendition:viewport')};return T}},{key:'parseManifest',value:function(L){var T={},E=(0,_.qsa)(L,'item'),z=Array.prototype.slice.call(E);return z.forEach(function(R){var N=R.getAttribute('id'),B=R.getAttribute('href')||'',O=R.getAttribute('media-type')||'',A=R.getAttribute('properties')||'';T[N]={href:B,type:O,properties:A.length?A.split(' '):[]}}),T}},{key:'parseSpine',value:function(L){var E=[],z=L.getElementsByTagName('itemref'),R=Array.prototype.slice.call(z);return R.forEach(function(N,B){var O=N.getAttribute('idref'),A=N.getAttribute('properties')||'',M=A.length?A.split(' '):[],W={idref:O,linear:N.getAttribute('linear')||'',properties:M,index:B};E.push(W)}),E}},{key:'findNavPath',value:function(L){var T=(0,_.qsp)(L,'item',{properties:'nav'});return!!T&&T.getAttribute('href')}},{key:'findNcxPath',value:function(L,T){var z,E=(0,_.qsp)(L,'item',{'media-type':'application/x-dtbncx+xml'});return E||(z=T.getAttribute('toc'),z&&(E=L.getElementById(z))),!!E&&E.getAttribute('href')}},{key:'findCoverPath',value:function(L){var T=(0,_.qs)(L,'package'),E=T.getAttribute('version');if('2.0'===E){var z=(0,_.qsp)(L,'meta',{name:'cover'});if(z){var R=z.getAttribute('content'),N=L.getElementById(R);return N?N.getAttribute('href'):''}return!1}var B=(0,_.qsp)(L,'item',{properties:'cover-image'});return B?B.getAttribute('href'):''}},{key:'getElementText',value:function(L,T){var z,E=L.getElementsByTagNameNS('http://purl.org/dc/elements/1.1/',T);return E&&0!==E.length?(z=E[0],z.childNodes.length?z.childNodes[0].nodeValue:''):''}},{key:'getPropertyText',value:function(L,T){var E=(0,_.qsp)(L,'meta',{property:T});return E&&E.childNodes.length?E.childNodes[0].nodeValue:''}},{key:'load',value:function(L){var T=this;return this.metadata=L.metadata,this.spine=L.spine.map(function(E,z){return E.index=z,E}),L.resources.forEach(function(E,z){T.manifest[z]=E,E.rel&&'cover'===E.rel[0]&&(T.coverPath=E.href)}),this.spineNodeIndex=0,this.toc=L.toc.map(function(E){return E.label=E.title,E}),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}},{key:'destroy',value:function(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}]),S}();p.default=C,u.exports=p['default']},function(u,p,f){'use strict';function k(T,E){if(!(T instanceof E))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function T(E,z){for(var N,R=0;R<z.length;R++)N=z[R],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(E,N.key,N)}return function(E,z,R){return z&&T(E.prototype,z),R&&T(E,R),E}}(),C=f(1),S=function(T){return T&&T.__esModule?T:{default:T}}(C),P=f(0),L=function(){function T(E){k(this,T),this.pages=[],this.locations=[],this.epubcfi=new S.default,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,this.lastPage,E&&(this.pageList=this.parse(E)),this.pageList&&this.pageList.length&&this.process(this.pageList)}return _(T,[{key:'parse',value:function(z){var R=(0,P.qs)(z,'html'),N=(0,P.qs)(z,'ncx');if(R)this.toc=this.parseNav(z);else if(N)return}},{key:'parseNav',value:function(z){var O,M,R=(0,P.querySelectorByType)(z,'nav','page-list'),N=R?(0,P.qsa)(R,'li'):[],B=N.length,A=[];if(!N||0===B)return A;for(O=0;O<B;++O)M=this.item(N[O]),A.push(M);return A}},{key:'item',value:function(z){var M,W,I,R=(0,P.qs)(z,'a'),N=R.getAttribute('href')||'',B=R.textContent||'',O=parseInt(B),A=N.indexOf('epubcfi');return-1==A?{href:N,page:O}:(M=N.split('#'),W=M[0],I=!!(1<M.length)&&M[1],{cfi:I,href:N,packageUrl:W,page:O})}},{key:'process',value:function(z){z.forEach(function(R){this.pages.push(R.page),R.cfi&&this.locations.push(R.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}},{key:'addCFIs',value:function(){this.pageList.forEach(function(z){!z.cfi})}},{key:'pageFromCfi',value:function(z){var R=-1;if(0===this.locations.length)return-1;var N=(0,P.indexOfSorted)(z,this.locations,this.epubcfi.compare);return-1==N?(N=(0,P.locationOf)(z,this.locations,this.epubcfi.compare),R=0<=N-1?this.pages[N-1]:this.pages[0],void 0!==R||(R=-1)):R=this.pages[N],R}},{key:'cfiFromPage',value:function(z){var R=-1;'number'!=typeof z&&(z=parseInt(z));var N=this.pages.indexOf(z);return-1!=N&&(R=this.locations[N]),R}},{key:'pageFromPercentage',value:function(z){var R=Math.round(this.totalPages*z);return R}},{key:'percentageFromPage',value:function(z){var R=(z-this.firstPage)/this.totalPages;return Math.round(1e3*R)/1e3}},{key:'percentageFromCfi',value:function(z){var R=this.pageFromCfi(z),N=this.percentageFromPage(R);return N}},{key:'destroy',value:function(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}]),T}();p.default=L,u.exports=p['default']},function(u,p,f){'use strict';function v(A){return A&&A.__esModule?A:{default:A}}function k(A,M){if(!(A instanceof M))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function A(M,W){for(var U,I=0;I<W.length;I++)U=W[I],U.enumerable=U.enumerable||!1,U.configurable=!0,'value'in U&&(U.writable=!0),Object.defineProperty(M,U.key,U)}return function(M,W,I){return W&&A(M.prototype,W),I&&A(M,I),M}}(),C=f(4),S=f(0),P=f(5),L=v(P),T=f(14),E=v(T),z=f(3),R=v(z),N=f(6),B=v(N),O=function(){function A(M,W){k(this,A),this.settings={replacements:W&&W.replacements||'base64',archive:W&&W.archive,resolver:W&&W.resolver,request:W&&W.request},this.manifest=M,this.resources=Object.keys(M).map(function(I){return M[I]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}return _(A,[{key:'split',value:function(){this.html=this.resources.filter(function(W){if('application/xhtml+xml'===W.type||'text/html'===W.type)return!0}),this.assets=this.resources.filter(function(W){if('application/xhtml+xml'!==W.type&&'text/html'!==W.type)return!0}),this.css=this.resources.filter(function(W){if('text/css'===W.type)return!0})}},{key:'splitUrls',value:function(){this.urls=this.assets.map(function(W){return W.href}.bind(this)),this.cssUrls=this.css.map(function(W){return W.href})}},{key:'createUrl',value:function(W){var I=new L.default(W),U=E.default.lookup(I.filename);return this.settings.archive?this.settings.archive.createUrl(W,{base64:'base64'===this.settings.replacements}):'base64'===this.settings.replacements?this.settings.request(W,'blob').then(function(F){return(0,S.blob2base64)(F)}).then(function(F){return(0,S.createBase64Url)(F,U)}):this.settings.request(W,'blob').then(function(F){return(0,S.createBlobUrl)(F,U)})}},{key:'replacements',value:function(){var W=this;if('none'===this.settings.replacements)return new Promise(function(I){I(this.urls)}.bind(this));var M=this.urls.map(function(I){var U=W.settings.resolver(I);return W.createUrl(U).catch(function(F){return console.error(F),null})});return Promise.all(M).then(function(I){return W.replacementUrls=I.filter(function(U){return'string'==typeof U}),I})}},{key:'replaceCss',value:function(W,I){var U=[];return W=W||this.settings.archive,I=I||this.settings.resolver,this.cssUrls.forEach(function(F){var D=this.createCssFile(F,W,I).then(function(H){var V=this.urls.indexOf(F);-1<V&&(this.replacementUrls[V]=H)}.bind(this));U.push(D)}.bind(this)),Promise.all(U)}},{key:'createCssFile',value:function(W){var U,I=this;if(B.default.isAbsolute(W))return new Promise(function(V){V()});var D,F=this.settings.resolver(W);D=this.settings.archive?this.settings.archive.getText(F):this.settings.request(F,'text');var H=this.urls.map(function(V){var X=I.settings.resolver(V),Y=new R.default(F).relative(X);return Y});return D?D.then(function(V){return V=(0,C.substitute)(V,H,I.replacementUrls),U='base64'===I.settings.replacements?(0,S.createBase64Url)(V,'text/css'):(0,S.createBlobUrl)(V,'text/css'),U},function(){return new Promise(function(X){X()})}):new Promise(function(V){V()})}},{key:'relativeTo',value:function(W,I){return I=I||this.settings.resolver,this.urls.map(function(U){var F=I(U),D=new R.default(W).relative(F);return D}.bind(this))}},{key:'get',value:function(W){var I=this.urls.indexOf(W);return-1===I?void 0:this.replacementUrls.length?new Promise(function(U){U(this.replacementUrls[I])}.bind(this)):this.createUrl(W)}},{key:'substitute',value:function(W,I){var U;return U=I?this.relativeTo(I):this.urls,(0,C.substitute)(W,U,this.replacementUrls)}},{key:'destroy',value:function(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}]),A}();p.default=O,u.exports=p['default']},function(u,p,f){'use strict';function v(R){return R&&R.__esModule?R:{default:R}}function k(R,N){if(!(R instanceof N))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function R(N,B){for(var A,O=0;O<B.length;O++)A=B[O],A.enumerable=A.enumerable||!1,A.configurable=!0,'value'in A&&(A.writable=!0),Object.defineProperty(N,A.key,A)}return function(N,B,O){return B&&R(N.prototype,B),O&&R(N,O),N}}(),C=f(0),S=f(1),P=v(S),L=f(9),T=v(L),E=f(4),z=function(){function R(N,B){k(this,R),this.idref=N.idref,this.linear=N.linear,this.properties=N.properties,this.index=N.index,this.href=N.href,this.url=N.url,this.next=N.next,this.prev=N.prev,this.cfiBase=N.cfiBase,B?this.hooks=B:(this.hooks={},this.hooks.serialize=new T.default(this),this.hooks.content=new T.default(this)),this.document=void 0,this.contents=void 0,this.output=void 0}return _(R,[{key:'load',value:function(B){var O=B||this.request||f(11),A=new C.defer,M=A.promise;return this.contents?A.resolve(this.contents):O(this.url).then(function(W){return this.document=W,this.contents=W.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){A.resolve(this.contents)}.bind(this)).catch(function(W){A.reject(W)}),M}},{key:'base',value:function(){return(0,E.replaceBase)(this.document,this)}},{key:'render',value:function(B){var O=new C.defer,A=O.promise;return this.output,this.load(B).then(function(M){var W,I;return I='undefined'==typeof XMLSerializer?f(15).XMLSerializer:XMLSerializer,W=new I,this.output=W.serializeToString(M),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){O.resolve(this.output)}.bind(this)).catch(function(M){O.reject(M)}),A}},{key:'find',value:function(){}},{key:'reconcileLayoutSettings',value:function(B){var O={layout:B.layout,spread:B.spread,orientation:B.orientation};return this.properties.forEach(function(A){var I,U,M=A.replace('rendition:',''),W=M.indexOf('-');-1!=W&&(I=M.slice(0,W),U=M.slice(W+1),O[I]=U)}),O}},{key:'cfiFromRange',value:function(B){return new P.default(B,this.cfiBase).toString()}},{key:'cfiFromElement',value:function(B){return new P.default(B,this.cfiBase).toString()}},{key:'unload',value:function(){this.document=void 0,this.contents=void 0,this.output=void 0}},{key:'destroy',value:function(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}]),R}();p.default=z,u.exports=p['default']},function(u,p,f){'use strict';function v(N){return N&&N.__esModule?N:{default:N}}function k(N,B){if(!(N instanceof B))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _=function(){function N(B,O){for(var M,A=0;A<O.length;A++)M=O[A],M.enumerable=M.enumerable||!1,M.configurable=!0,'value'in M&&(M.writable=!0),Object.defineProperty(B,M.key,M)}return function(B,O,A){return O&&N(B.prototype,O),A&&N(B,A),B}}(),C=f(1),S=v(C),P=f(9),L=v(P),T=f(31),E=v(T),z=f(4),R=function(){function N(){k(this,N),this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new L.default,this.hooks.content=new L.default,this.hooks.content.register(z.replaceBase),this.hooks.content.register(z.replaceCanonical),this.epubcfi=new S.default,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}return _(N,[{key:'unpack',value:function(O,A){var M=this;this.items=O.spine,this.manifest=O.manifest,this.spineNodeIndex=O.spineNodeIndex,this.baseUrl=O.baseUrl||O.basePath||'',this.length=this.items.length,this.items.forEach(function(W,I){var F,U=M.manifest[W.idref];W.cfiBase=M.epubcfi.generateChapterComponent(M.spineNodeIndex,W.index,W.idref),W.href&&(W.url=A(W.href,!0)),U&&(W.href=U.href,W.url=A(W.href,!0),U.properties.length&&W.properties.push.apply(W.properties,U.properties)),W.prev=function(){return this.get(I-1)}.bind(M),W.next=function(){return this.get(I+1)}.bind(M),F=new E.default(W,M.hooks),M.append(F)}),this.loaded=!0}},{key:'get',value:function(O){var A=0;if(this.epubcfi.isCfiString(O)){var M=new S.default(O);A=M.spinePos}else O&&('number'==typeof O||!1===isNaN(O))?A=O:O&&0===O.indexOf('#')?A=this.spineById[O.substring(1)]:O&&(O=O.split('#')[0],A=this.spineByHref[O]);return this.spineItems[A]||null}},{key:'append',value:function(O){var A=this.spineItems.length;return O.index=A,this.spineItems.push(O),this.spineByHref[O.href]=A,this.spineById[O.idref]=A,A}},{key:'prepend',value:function(O){return this.spineByHref[O.href]=0,this.spineById[O.idref]=0,this.spineItems.forEach(function(A,M){A.index=M}),0}},{key:'remove',value:function(O){var A=this.spineItems.indexOf(O);if(-1<A)return delete this.spineByHref[O.href],delete this.spineById[O.idref],this.spineItems.splice(A,1)}},{key:'each',value:function(){return this.spineItems.forEach.apply(this.spineItems,arguments)}},{key:'destroy',value:function(){this.each(function(O){return O.destroy()}),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}]),N}();p.default=R,u.exports=p['default']},function(u,p,f){'use strict';function k(T,E){if(!(T instanceof E))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var _='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(T){return typeof T}:function(T){return T&&'function'==typeof Symbol&&T.constructor===Symbol&&T!==Symbol.prototype?'symbol':typeof T},C=function(){function T(E,z){for(var N,R=0;R<z.length;R++)N=z[R],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(E,N.key,N)}return function(E,z,R){return z&&T(E.prototype,z),R&&T(E,R),E}}(),S=f(5),P=function(T){return T&&T.__esModule?T:{default:T}}(S),L=function(){function T(E){k(this,T),this.rendition=E,this._themes={'default':{rules:{},url:'',serialized:''}},this._overrides={},this._current='default',this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}return C(T,[{key:'register',value:function(){return 0===arguments.length?void 0:1===arguments.length&&'object'===_(arguments[0])?this.registerThemes(arguments[0]):1===arguments.length&&'string'==typeof arguments[0]?this.default(arguments[0]):2===arguments.length&&'string'==typeof arguments[1]?this.registerUrl(arguments[0],arguments[1]):2===arguments.length&&'object'===_(arguments[1])?this.registerRules(arguments[0],arguments[1]):void 0}},{key:'default',value:function(z){return z?'string'==typeof z?this.registerUrl('default',z):'object'===('undefined'==typeof z?'undefined':_(z))?this.registerRules('default',z):void 0:void 0}},{key:'registerThemes',value:function(z){for(var R in z)z.hasOwnProperty(R)&&('string'==typeof z[R]?this.registerUrl(R,z[R]):this.registerRules(R,z[R]))}},{key:'registerUrl',value:function(z,R){var N=new P.default(R);this._themes[z]={url:N.toString()},this._injected[z]&&this.update(z)}},{key:'registerRules',value:function(z,R){this._themes[z]={rules:R},this._injected[z]&&this.update(z)}},{key:'apply',value:function(z){var N,R=this._current;this._current=z,this.update(z),N=this.rendition.getContents(),N.forEach(function(B){B.removeClass(R),B.addClass(z)})}},{key:'update',value:function(z){var R=this,N=this.rendition.getContents();N.forEach(function(B){R.add(z,B)})}},{key:'inject',value:function(z){var B,R=[],N=this._themes;for(var O in N)N.hasOwnProperty(O)&&O===this._current&&(B=N[O],(B.rules||B.url&&-1===R.indexOf(B.url))&&this.add(O,z),this._injected.push(O));'default'!=this._current&&z.addClass(this._current)}},{key:'add',value:function(z,R){var N=this._themes[z];N&&(N.url?R.addStylesheet(N.url):N.serialized||N.rules&&(R.addStylesheetRules(N.rules),N.injected=!0))}},{key:'override',value:function(z,R){var N=this,B=this.rendition.getContents();this._overrides[z]=R,B.forEach(function(O){O.css(z,N._overrides[z])})}},{key:'overrides',value:function(z){var E=this._overrides;for(var R in E)E.hasOwnProperty(R)&&z.css(R,E[R])}},{key:'fontSize',value:function(z){this.override('font-size',z)}},{key:'destroy',value:function(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}]),T}();p.default=L,u.exports=p['default']},function(u,p,f){'use strict';var S,v=f(35),k=f(42),_=f(38),C=f(45);S=u.exports=function(P,L){var T,E,z,R,N;return 2>arguments.length||'string'!=typeof P?(R=L,L=P,P=null):R=arguments[2],null==P?(T=z=!0,E=!1):(T=C.call(P,'c'),E=C.call(P,'e'),z=C.call(P,'w')),N={value:L,configurable:T,enumerable:E,writable:z},R?v(k(R),N):N},S.gs=function(P,L,T){var E,z,R,N;return'string'==typeof P?R=arguments[3]:(R=T,T=L,L=P,P=null),null==L?L=void 0:_(L)?null==T?T=void 0:!_(T)&&(R=T,T=void 0):(R=L,L=T=void 0),null==P?(E=!0,z=!1):(E=C.call(P,'c'),z=C.call(P,'e')),N={get:L,set:T,configurable:E,enumerable:z},R?v(k(R),N):N}},function(u,p,f){'use strict';u.exports=f(36)()?Object.assign:f(37)},function(u){'use strict';u.exports=function(){var k,v=Object.assign;return!('function'!=typeof v)&&(k={foo:'raz'},v(k,{bar:'dwa'},{trzy:'trzy'}),'razdwatrzy'===k.foo+k.bar+k.trzy)}},function(u,p,f){'use strict';var v=f(39),k=f(44),_=Math.max;u.exports=function(C,S){var P,L,E,T=_(arguments.length,2);for(C=Object(k(C)),E=function(z){try{C[z]=S[z]}catch(R){P||(P=R)}},L=1;L<T;++L)S=arguments[L],v(S).forEach(E);if(P!==void 0)throw P;return C}},function(u){'use strict';u.exports=function(v){return'function'==typeof v}},function(u,p,f){'use strict';u.exports=f(40)()?Object.keys:f(41)},function(u){'use strict';u.exports=function(){try{return Object.keys('primitive'),!0}catch(v){return!1}}},function(u){'use strict';var v=Object.keys;u.exports=function(k){return v(null==k?k:Object(k))}},function(u){'use strict';var v=Array.prototype.forEach,k=Object.create,_=function(C,S){for(var P in C)S[P]=C[P]};u.exports=function(){var S=k(null);return v.call(arguments,function(P){null==P||_(Object(P),S)}),S}},function(u){'use strict';u.exports=function(v){if('function'!=typeof v)throw new TypeError(v+' is not a function');return v}},function(u){'use strict';u.exports=function(v){if(null==v)throw new TypeError('Cannot use null or undefined');return v}},function(u,p,f){'use strict';u.exports=f(46)()?String.prototype.contains:f(47)},function(u){'use strict';var v='razdwatrzy';u.exports=function(){return!('function'!=typeof v.contains)&&!0===v.contains('dwa')&&!1===v.contains('foo')}},function(u){'use strict';var v=String.prototype.indexOf;u.exports=function(k){return-1<v.call(this,k,arguments[1])}},function(u){function f(){throw new Error('setTimeout has not been defined')}function v(){throw new Error('clearTimeout has not been defined')}function k(A){if(E===setTimeout)return setTimeout(A,0);if((E===f||!E)&&setTimeout)return E=setTimeout,setTimeout(A,0);try{return E(A,0)}catch(M){try{return E.call(null,A,0)}catch(W){return E.call(this,A,0)}}}function _(A){if(z===clearTimeout)return clearTimeout(A);if((z===v||!z)&&clearTimeout)return z=clearTimeout,clearTimeout(A);try{return z(A)}catch(M){try{return z.call(null,A)}catch(W){return z.call(this,A)}}}function C(){N&&B&&(N=!1,B.length?R=B.concat(R):O=-1,R.length&&S())}function S(){if(!N){var A=k(C);N=!0;for(var M=R.length;M;){for(B=R,R=[];++O<M;)B&&B[O].run();O=-1,M=R.length}B=null,N=!1,_(A)}}function P(A,M){this.fun=A,this.array=M}function L(){}var T=u.exports={},E,z;(function(){try{E='function'==typeof setTimeout?setTimeout:f}catch(A){E=f}try{z='function'==typeof clearTimeout?clearTimeout:v}catch(A){z=v}})();var R=[],N=!1,B,O=-1;T.nextTick=function(A){var M=Array(arguments.length-1);if(1<arguments.length)for(var W=1;W<arguments.length;W++)M[W-1]=arguments[W];R.push(new P(A,M)),1!==R.length||N||k(S)},P.prototype.run=function(){this.fun.apply(null,this.array)},T.title='browser',T.browser=!0,T.env={},T.argv=[],T.version='',T.versions={},T.on=L,T.addListener=L,T.once=L,T.off=L,T.removeListener=L,T.removeAllListeners=L,T.emit=L,T.binding=function(){throw new Error('process.binding is not supported')},T.cwd=function(){return'/'},T.chdir=function(){throw new Error('process.chdir is not supported')},T.umask=function(){return 0}},function(u){if('undefined'==typeof s){var f=new Error('Cannot find module "JSZip"');throw f.code='MODULE_NOT_FOUND',f}u.exports=s}])});